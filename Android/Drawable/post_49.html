<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>å¥½ç©ç³»åˆ—ï¼šè®©ImageSpanåŠ¨èµ·æ¥ - leobert&#x27;s blog</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">ç›®å½•</li><li class="chapter-item expanded "><a href="../../Android/index.html"><strong aria-hidden="true">1.</strong> Android</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/View/index.html"><strong aria-hidden="true">1.1.</strong> View</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/View/post_1.html"><strong aria-hidden="true">1.1.1.</strong> å¥½ç©ç³»åˆ—ï¼šä¼˜é›…çš„å¤„ç†ButterKnifeå’ŒKAEè¢«åºŸå¼ƒ</a></li><li class="chapter-item expanded "><a href="../../Android/View/post_6.html"><strong aria-hidden="true">1.1.2.</strong> ä¸‰æ€ç³»åˆ—ï¼šViewä½“ç³»è®¤çŸ¥(ä¸€)ï¼Œå†…å®¹æ˜¯å¦‚ä½•æ­£ç¡®è¢«å±•ç°å‡ºæ¥çš„--è§†è§‰å‘ˆç°æ¦‚è§ˆ</a></li><li class="chapter-item expanded "><a href="../../Android/View/post_7.html"><strong aria-hidden="true">1.1.3.</strong> ä¸‰æ€ç³»åˆ—ï¼šä¸ºä»€ä¹ˆè‡ªå®šä¹‰View</a></li><li class="chapter-item expanded "><a href="../../Android/Idea/post_9.html"><strong aria-hidden="true">1.1.4.</strong> ä¸‰æ€ç³»åˆ—ï¼š"å£°æ˜å¼UI"å’Œ"å‘½ä»¤å¼UI"ï¼Œä½ çš„ç†è§£å¯èƒ½æ˜¯é”™çš„</a></li></ol></li><li class="chapter-item expanded "><a href="../../Android/Drawable/index.html"><strong aria-hidden="true">1.2.</strong> Drawable</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/Drawable/post_2.html"><strong aria-hidden="true">1.2.1.</strong> ä¸‰æ€ç³»åˆ—ï¼šé‡æ–°è®¤è¯†Drawable</a></li><li class="chapter-item expanded "><a href="../../Android/Drawable/post_4.html"><strong aria-hidden="true">1.2.2.</strong> å¥½ç©ç³»åˆ—ï¼šæ‹¥æœ‰å®ƒï¼ŒXMLæ–‡ä»¶å°‘ä¸€åŠ--æ›´æ–¹ä¾¿çš„å¤„ç†ViewèƒŒæ™¯</a></li><li class="chapter-item expanded "><a href="../../Android/Drawable/post_47.html"><strong aria-hidden="true">1.2.3.</strong> è¿Ÿæ¥çš„ç»­é›†--Drawable+Animatorï¼Œå°†ä¼˜é›…è¿›è¡Œåˆ°åº•</a></li><li class="chapter-item expanded "><a href="../../Android/Drawable/post_49.html" class="active"><strong aria-hidden="true">1.2.4.</strong> å¥½ç©ç³»åˆ—ï¼šè®©ImageSpanåŠ¨èµ·æ¥</a></li></ol></li><li class="chapter-item expanded "><a href="../../Android/Mechanism/Message/index.html"><strong aria-hidden="true">1.3.</strong> æ¶ˆæ¯æœºåˆ¶</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/Mechanism/Message/post_8.html"><strong aria-hidden="true">1.3.1.</strong> ä¸‰æ€ç³»åˆ—ï¼šAndroidçš„æ¶ˆæ¯æœºåˆ¶ï¼Œä¸€æ–‡åƒé€</a></li></ol></li><li class="chapter-item expanded "><a href="../../Android/Idea/post_14/index.html"><strong aria-hidden="true">1.4.</strong> å…¼å®¹</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/Idea/post_14.html"><strong aria-hidden="true">1.4.1.</strong> å¥½ç©ç³»åˆ—ï¼šè®©é¡¹ç›®ä¸­çš„ç›¸å†Œæ”¯æŒHeifæ ¼å¼å›¾ç‰‡</a></li></ol></li><li class="chapter-item expanded "><a href="../../Android/Glide/index.html"><strong aria-hidden="true">1.5.</strong> Glide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/Glide/post_15.html"><strong aria-hidden="true">1.5.1.</strong> ä¸‰æ€ç³»åˆ—ï¼šGlide 4.Xå…¨æ–¹ä½è®¤çŸ¥ -- æ¨¡å—èŒè´£æ¦‚è§ˆ</a></li><li class="chapter-item expanded "><a href="../../Android/Glide/post_16.html"><strong aria-hidden="true">1.5.2.</strong> ä¸‰æ€ç³»åˆ—ï¼šGlide 4.XåŠ è½½è¿‡ç¨‹ä¸€æ–‡æŒæ¡ | Glideï¼ˆäºŒï¼‰</a></li></ol></li><li class="chapter-item expanded "><a href="../../Android/KSP/index.html"><strong aria-hidden="true">1.6.</strong> KSP</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/KSP/post_24.html"><strong aria-hidden="true">1.6.1.</strong> å¥½ç©ç³»åˆ— | æ‹¥æŠ±Kotlin Symbol Processing(KSP),é¡¹ç›®å®æˆ˜</a></li></ol></li><li class="chapter-item expanded "><a href="../../Android/Base/index.html"><strong aria-hidden="true">1.7.</strong> åŸºç¡€</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/Base/post_35.html"><strong aria-hidden="true">1.7.1.</strong> å­”ä¹™å·±ï¼šä½ å¯çŸ¥é“é¡µé¢å’Œå¼¹çª—â€œé€šä¿¡â€œçš„æ–¹å¼æœ‰å››ç§ï¼Ÿ</a></li></ol></li><li class="chapter-item expanded "><a href="../../Android/SysApp/index.html"><strong aria-hidden="true">1.8.</strong> ç³»ç»ŸAPP</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/SysApp/post_52.html"><strong aria-hidden="true">1.8.1.</strong> ä½¿ç”¨æ—¥å†ä¸°å¯Œäº§å“çš„ç”¨æˆ·ä½“éªŒ</a></li></ol></li><li class="chapter-item expanded "><a href="../../Android/DI/index.html"><strong aria-hidden="true">1.9.</strong> Part4-ä¾èµ–æ³¨å…¥éƒ¨åˆ†</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Android/DI/post_53.html"><strong aria-hidden="true">1.9.1.</strong> Hiltè¿›é˜¶--ä¸€æ–‡åƒé€Hiltè‡ªå®šä¹‰ä¸è·¨å£å’</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../Compose/index.html"><strong aria-hidden="true">2.</strong> Jetpack Compose</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Compose/post_21.html"><strong aria-hidden="true">2.1.</strong> Jetpack Compose | ä¸€æ–‡ç†è§£ç¥å¥‡çš„Modifier</a></li><li class="chapter-item expanded "><a href="../../Compose/post_26.html"><strong aria-hidden="true">2.2.</strong> Jetpack Compose | æ§ä»¶ç¯‡ï¼ˆä¸€ï¼‰ -- Textã€TextFieldã€Button</a></li><li class="chapter-item expanded "><a href="../../Compose/post_27.html"><strong aria-hidden="true">2.3.</strong> Jetpack Compose | æ§ä»¶ç¯‡ï¼ˆäºŒï¼‰ -- Iconï¼ŒImage</a></li><li class="chapter-item expanded "><a href="../../Compose/post_28.html"><strong aria-hidden="true">2.4.</strong> Jetpack Compose | æ§ä»¶ç¯‡ï¼ˆä¸‰ï¼‰ -- Switchã€CheckBoxã€RadioButton</a></li><li class="chapter-item expanded "><a href="../../Compose/post_29.html"><strong aria-hidden="true">2.5.</strong> Jetpack Compose | æ§ä»¶ç¯‡ï¼ˆå››ï¼‰-- Boxã€Rowã€Column</a></li><li class="chapter-item expanded "><a href="../../Compose/post_30.html"><strong aria-hidden="true">2.6.</strong> Jetpack Compose | æ§ä»¶ç¯‡ï¼ˆäº”ï¼‰-- Spacerã€LazyRowã€LazyColumn & è®©Columnå¯æ»‘åŠ¨</a></li></ol></li><li class="chapter-item expanded "><a href="../../MultiThreading/index.html"><strong aria-hidden="true">3.</strong> Javaå¤šçº¿ç¨‹</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../MultiThreading/post_33.html"><strong aria-hidden="true">3.1.</strong> æ€»çº²</a></li><li class="chapter-item expanded "><a href="../../MultiThreading/post_37.html"><strong aria-hidden="true">3.2.</strong> JavaåŸºç¡€--å›¾è§£JVMå†…å­˜æ¨¡å‹å’ŒJVMçº¿ç¨‹æ¨¡å‹</a></li><li class="chapter-item expanded "><a href="../../MultiThreading/post_38.html"><strong aria-hidden="true">3.3.</strong> Javaå¤šçº¿ç¨‹ç³»åˆ—--æŒæ§é¢è¯•ï¼Œä¸€æ–‡åƒé€Synchronizedé”</a></li><li class="chapter-item expanded "><a href="../../MultiThreading/post_39.html"><strong aria-hidden="true">3.4.</strong> Javaå¤šçº¿ç¨‹åŸºç¡€--çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹åä½œè¯¦è§£</a></li><li class="chapter-item expanded "><a href="../../MultiThreading/post_42.html"><strong aria-hidden="true">3.5.</strong> Javaå¤šçº¿ç¨‹åŸºç¡€--çº¿ç¨‹çš„åˆ›å»ºä¸çº¿ç¨‹æ± ç®¡ç†</a></li><li class="chapter-item expanded "><a href="../../MultiThreading/post_46.html"><strong aria-hidden="true">3.6.</strong> Javaå¤šçº¿ç¨‹ç³»åˆ—--æŒæ¡Futureï¼Œè½»æ¾è·å–å¼‚æ­¥ä»»åŠ¡ç»“æœ</a></li><li class="chapter-item expanded "><a href="../../MultiThreading/post_50.html"><strong aria-hidden="true">3.7.</strong> Javaå¤šçº¿ç¨‹ç³»åˆ—--Fork&Joinæ¡†æ¶ï¼Œåˆ†æ²»çš„è‰ºæœ¯</a></li><li class="chapter-item expanded "><a href="../../MultiThreading/post_54.html"><strong aria-hidden="true">3.8.</strong> Javaå¤šçº¿ç¨‹ç³»åˆ—--æŒæ¡CompletableFutureï¼Œé©¾é©­å¼‚æ­¥ç¼–ç¨‹</a></li></ol></li><li class="chapter-item expanded "><a href="../../IO/index.html"><strong aria-hidden="true">4.</strong> Java IOç³»åˆ—</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../IO/post_55.html"><strong aria-hidden="true">4.1.</strong> Java IO ç³»åˆ—æ€»çº²</a></li><li class="chapter-item expanded "><a href="../../IO/post_56.html"><strong aria-hidden="true">4.2.</strong> Java IOç³»åˆ— | ç»å…¸ IO</a></li><li class="chapter-item expanded "><a href="../../IO/post_57.html"><strong aria-hidden="true">4.3.</strong> Java IO ç³»åˆ— | NIO-1.0ä¸€æ–‡é€Ÿè§ˆ</a></li><li class="chapter-item expanded "><a href="../../IO/post_58.html"><strong aria-hidden="true">4.4.</strong> Java IOç³»åˆ— | NIO-1.0æ‹¾é—ã€NIO-2.0 & é›¶æ‹·è´å¿…å¹çš„ç‰›çš®</a></li><li class="chapter-item expanded "><a href="../../IO/post_59.html"><strong aria-hidden="true">4.5.</strong> IOç³»åˆ— | ä¸€æ–‡æŒæ¡OKHTTPä¸­çš„OKIOä¸ºä»€ä¹ˆè¿™ä¹ˆOK</a></li></ol></li><li class="chapter-item expanded "><a href="../../Gradle/index.html"><strong aria-hidden="true">5.</strong> Gradle</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Gradle/Modularization/post_18.html"><strong aria-hidden="true">5.1.</strong> ç»„ä»¶åŒ–ï¼šä¸‰æ€ç³»åˆ—ï¼šç»„ä»¶åŒ–åœºæ™¯ä¸‹moduleä¾èµ–ä¼˜é›…å®è·µæ–¹æ¡ˆ</a></li><li class="chapter-item expanded "><a href="../../Gradle/Publish/post_17.html"><strong aria-hidden="true">5.2.</strong> MavenCentralå‘å¸ƒï¼šè¿ç§»åˆ°MavenCentral--å†ä¸è¡ŒåŠ¨èµ·æ¥ï¼Œä½ çš„æ‰˜ç®¡çš„libraryå°±æ²¡äº†</a></li><li class="chapter-item expanded "><a href="../../Gradle/post_22.html"><strong aria-hidden="true">5.3.</strong> Gradle | ä¾èµ–ç®¡ç†æœ€ä½³å®è·µ</a></li></ol></li><li class="chapter-item expanded "><a href="../../Groovy/index.html"><strong aria-hidden="true">6.</strong> Groovy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Groovy/why_write_groovy.html"><strong aria-hidden="true">6.1.</strong> ä¸ºä»€ä¹ˆæ’°å†™è¿™ä¸ªç³»åˆ—</a></li><li class="chapter-item expanded "><a href="../../Groovy/post_23.html"><strong aria-hidden="true">6.2.</strong> Groovyï¼šMOPä¸€æ–‡æ‰“å°½</a></li></ol></li><li class="chapter-item expanded "><a href="../../Review/index.html"><strong aria-hidden="true">7.</strong> Review</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Review/post_10.html"><strong aria-hidden="true">7.1.</strong> é€ å®Œäº†è¿™ä¸ªè½®å­--Mockerï¼Œå´è®©æˆ‘æ„Ÿåˆ°å¾ˆç¾æ„§|é¡¹ç›®å¤ç›˜</a></li><li class="chapter-item expanded "><a href="../../Review/post_40.html"><strong aria-hidden="true">7.2.</strong> ä¸‰æ€ç³»åˆ—ï¼šå‰äººç”¨GreenDaoç•™ä¸‹çš„å‘ï¼Œå…¨çº¿è¢«æ‰£äº†ç»©æ•ˆ</a></li><li class="chapter-item expanded "><a href="../../Review/post_44.html"><strong aria-hidden="true">7.3.</strong> è°ˆä¸€è°ˆåœ¨ä¸¤ä¸ªå•†ä¸šé¡¹ç›®ä¸­ä½¿ç”¨MVIæ¶æ„åçš„æ„Ÿæ‚Ÿ</a></li><li class="chapter-item expanded "><a href="../../Review/post_45.html"><strong aria-hidden="true">7.4.</strong> Review | è¿™ä¸‰ä¸ªå‘ä½ é‡åˆ°äº†å—ï¼Ÿ</a></li></ol></li><li class="chapter-item expanded "><a href="../../repo/index.html"><strong aria-hidden="true">8.</strong> ä¸ªäººé¡¹ç›®</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../repo/DaVinCi.html"><strong aria-hidden="true">8.1.</strong> DaVinCi,å–ä»£XMLç¼–å†™Shapeæˆ–ColorStateListçš„æ–¹æ¡ˆ</a></li><li class="chapter-item expanded "><a href="../../Android/Idea/post_32.html"><strong aria-hidden="true">8.2.</strong> å¥½ç©ç³»åˆ—ï¼šç™½å«–ä¸€ä¸ªä¼˜é›…çš„ç±»å›¾ç”Ÿæˆå·¥å…·</a></li><li class="chapter-item expanded "><a href="../../Speculative/post_43.html"><strong aria-hidden="true">8.3.</strong> åˆä½“éªŒï¼šåŠ¨æ‰‹æ­å»º"å°æ¸…æ–°å¼"å±€åŸŸç½‘æ–‡æ¡£ç³»ç»Ÿ</a></li><li class="chapter-item expanded "><a href="../../repo/post_48.html"><strong aria-hidden="true">8.4.</strong> ç ”ç©¶è‰¯ä¹…ï¼Œç»ˆäºå‘ç°äº†ä»–ä»£ç å†™çš„å¿«ä¸”bugå°‘çš„åŸå› </a></li><li class="chapter-item expanded "><a href="../../Speculative/post_61.html"><strong aria-hidden="true">8.5.</strong> å¥½ç©ç³»åˆ— | å¦‚æœåç«¯è®©ä½ ç”¨SSEæ¥æ”¶å¤šæ¬¡è¿”å›ï¼Œé‚£æˆ‘ä»¬æ”¹é€ Retrofitå§</a></li></ol></li><li class="chapter-item expanded "><a href="../../Review/DataStructure/index.html"><strong aria-hidden="true">9.</strong> æ•°æ®ç»“æ„</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Review/DataStructure/post_11.html"><strong aria-hidden="true">9.1.</strong> æ¸©æ•…ï¼šçº¿æ€§è¡¨</a></li><li class="chapter-item expanded "><a href="../../Review/DataStructure/post_12.html"><strong aria-hidden="true">9.2.</strong> æ¸©æ•…ï¼šæ ˆ</a></li><li class="chapter-item expanded "><a href="../../Review/DataStructure/post_13.html"><strong aria-hidden="true">9.3.</strong> æ¸©æ•…ï¼šé˜Ÿåˆ—</a></li></ol></li><li class="chapter-item expanded "><a href="../../Review/README2.html"><strong aria-hidden="true">10.</strong> å¹´ç»ˆæ€»ç»“&è®¡åˆ’</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Review/post_36.html"><strong aria-hidden="true">10.1.</strong> 2021å¹´ç»ˆæ€»ç»“</a></li><li class="chapter-item expanded "><a href="../../Review/post_51.html"><strong aria-hidden="true">10.2.</strong> å…³äºç”»ä¸€ä¸ªå¥å·--åŸºäº2022å¹´ç»ˆæ€»ç»“çš„åæ€ä¸åˆ†äº«</a></li><li class="chapter-item expanded "><a href="../../Review/post_60.html"><strong aria-hidden="true">10.3.</strong> çªå¦‚å…¶æ¥çš„ç§‹å­£åæ€</a></li><li class="chapter-item expanded "><a href="../../Review/post_63.html"><strong aria-hidden="true">10.4.</strong> 2023å¹´æ€»ç»“ å¯»æ‰¾åˆ°æºäºå†…å¿ƒæ·±å¤„çš„æ— ç©·åŠ›é‡</a></li><li class="chapter-item expanded "><a href="../../Review/post_64.html"><strong aria-hidden="true">10.5.</strong> 2024å¹´ä¸­æ€è€ƒï¼Œæ¨å€’æ¨Šç¬¼é‡æ–°å‡ºå‘</a></li></ol></li><li class="chapter-item expanded "><a href="../../Note/index.html"><strong aria-hidden="true">11.</strong> è¯»ä¹¦ç¬”è®°</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Note/post_41.html"><strong aria-hidden="true">11.1.</strong> è¯»ä¹¦ç¬”è®°ï¼šã€Šç®€çº¦è‡³ä¸Š--äº¤äº’å¼è®¾è®¡å››ç­–ç•¥ã€‹</a></li><li class="chapter-item expanded "><a href="../../Talk/talk_4_2024-08.html"><strong aria-hidden="true">11.2.</strong> è¯»ä¹¦ç¬”è®° - ã€Šå›¢é˜Ÿç®¡ç†ã€‹ç²¾åæ‘˜è¦</a></li></ol></li><li class="chapter-item expanded "><a href="../../Talk/index.html"><strong aria-hidden="true">12.</strong> æ‚è°ˆ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Talk/talk_1.html"><strong aria-hidden="true">12.1.</strong> æ‚è°ˆ1-2022-11</a></li><li class="chapter-item expanded "><a href="../../Talk/talk_2_2023-03.html"><strong aria-hidden="true">12.2.</strong> æ‚ç¯‡ï¼ˆäºŒï¼‰-- è®¤è¯†å¹¶æˆ˜èƒœç„¦è™‘</a></li><li class="chapter-item expanded "><a href="../../Talk/talk_3_2024-08.html"><strong aria-hidden="true">12.3.</strong> æ‚è°ˆï¼ˆä¸‰ï¼‰-- å‘é’±çœ‹ï¼Œä½ éœ€è¦æƒ³æ˜ç™½ä¼ä¸šåœ¨ä¸ºä»€ä¹ˆè€Œä»˜é’±</a></li></ol></li><li class="chapter-item expanded "><a href="../../Thought/index.html"><strong aria-hidden="true">13.</strong> åŠæˆç†Ÿçš„æ€è€ƒ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Thought/post_62.html"><strong aria-hidden="true">13.1.</strong> å¥½ç©ç³»åˆ— | å½“SPI å’Œ è®¾è®¡æ¨¡å¼ã€ä¾èµ–æ³¨å…¥å‘ç”Ÿç¢°æ’ï¼Œå¯ä»¥æ“¦å‡ºæ€æ ·çš„ç«èŠ±</a></li></ol></li><li class="chapter-item expanded "><a href="../../info/index.html"><strong aria-hidden="true">14.</strong> ç³»åˆ—è¯´æ˜</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../info/about_view_series.html"><strong aria-hidden="true">14.1.</strong> å…³äºViewç³»åˆ—</a></li><li class="chapter-item expanded "><a href="../../info/about_sansi_series.html"><strong aria-hidden="true">14.2.</strong> å…³äºä¸‰æ€ç³»åˆ—</a></li><li class="chapter-item expanded "><a href="../../info/about_haowan_series.html"><strong aria-hidden="true">14.3.</strong> å…³äºå¥½ç©ç³»åˆ—</a></li><li class="chapter-item expanded "><a href="../../info/about_wengu_series.html"><strong aria-hidden="true">14.4.</strong> å…³äºæ¸©æ•…ç³»åˆ—</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">leobert&#x27;s blog</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="å¥½ç©ç³»åˆ—è®©imagespanåŠ¨èµ·æ¥"><a class="header" href="#å¥½ç©ç³»åˆ—è®©imagespanåŠ¨èµ·æ¥">å¥½ç©ç³»åˆ—ï¼šè®©ImageSpanåŠ¨èµ·æ¥</a></h1>
<h2 id="å‰è¨€"><a class="header" href="#å‰è¨€">å‰è¨€</a></h2>
<p>å‰ä¸ä¹…ï¼Œæˆ‘å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/7155690991721119781">è¿Ÿæ¥çš„ç»­é›†--Drawable+Animatorï¼Œå°†ä¼˜é›…è¿›è¡Œåˆ°åº•</a> , å¹¶åœ¨å…¶ä¸­ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜ï¼š"
ç”¨ åŠ¨ç”»Drawable æ˜¯å¦å¯ä»¥è®© ImageSpan ç›´æ¥åŠ¨èµ·æ¥"</p>
<p>ç›¸ä¿¡å¤§å®¶ä¹Ÿè¿›è¡Œäº†å°è¯•ï¼Œå¹¶ä¸”ä¸å‡ºæ„å¤–åœ°å‡ºç°äº†æ„å¤–ï¼å³ä¾¿ä½¿ç”¨å¯ä»¥åŠ¨èµ·æ¥çš„Drawableæ„å»ºImageSpanï¼Œä¹Ÿæ²¡æœ‰è®©ä»–åŠ¨èµ·æ¥ï¼</p>
<img width="220" alt="é—®é¢˜ä¸å¤§" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8310c4177171446a92661e4e576df8ae~tplv-k3u1fbpfcp-watermark.image?"/>
<p>ä»Šå¤©æˆ‘ä»¬å°†åœ¨ä¸€ä¸ªæ„‰å¿«çš„æ°›å›´ä¸‹ï¼Œè®©ImageSpanåŠ¨èµ·æ¥ï¼Œå¹¶è¿›è¡Œä¸€äº›æ›´æ·±å±‚æ¬¡çš„æ¢ç´¢ï¼Œä¸å‡ºæ„å¤–ï¼Œè¿™å°†æ˜¯Drawableç›¸å…³æ–‡ç« çš„ç»ˆç»“ç¯‡ã€‚</p>
<p>å¦å¤–ï¼Œæœ‰å‡ ç¯‡ç›¸å…³æ–‡ç« å¯ä»¥ä½œä¸ºæ‰©å±•é˜…è¯»ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/6924240361317466125">ä¸‰æ€ç³»åˆ—ï¼šé‡æ–°è®¤è¯†Drawable</a></li>
<li><a href="https://juejin.cn/post/6934222774139518984">ä¸‰æ€ç³»åˆ—ï¼šä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰View </a></li>
</ul>
<h2 id="æ˜¯å¦ç”¨å¾—ä¸Š"><a class="header" href="#æ˜¯å¦ç”¨å¾—ä¸Š">æ˜¯å¦ç”¨å¾—ä¸Š</a></h2>
<blockquote>
<p>"å­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦è¯´ä¹" -- ã€Šè®ºè¯­-å­¦è€Œã€‹</p>
</blockquote>
<p>Spanæ˜¯Androidä¸­å®ç°å¯Œæ–‡æœ¬çš„ä¸€ç§æ–¹å¼ï¼Œè¯»è€…è¯¸å›è¯·æ³¨æ„ï¼Œ<strong>æ˜¯ä¸€ç§æ–¹å¼è€Œä¸æ˜¯å”¯ä¸€æ–¹å¼ï¼</strong>
é™¤å´Spanæœºåˆ¶ï¼Œä¾æ—§æœ‰å…¶ä»–å½¢å¼å±•ç°å¯Œæ–‡æœ¬ã€‚</p>
<p>ä½†ä¸å¯å¦è®¤ï¼šSpanæ˜¯éå¸¸è½»é‡çš„ä¸€ç§æ–¹å¼ï¼Œè™½ç„¶è¿™ç§ <code>è„±ç¦»å±•ç¤ºå®¹å™¨çš„è½»é‡</code> ä½¿å¾—å®ƒçš„è®¾è®¡å¹¶ä¸ç®€å•ï¼Œ
å¯¼è‡´äº†ç®€å•ä½¿ç”¨å®ƒæ—¶å¾ˆæ–¹ä¾¿ï¼Œé‡åº¦ä½¿ç”¨å®ƒæ—¶ <strong>éš¾ä»¥å¦‚æŒ‡è‡‚ä½¿</strong> ï¼Œå¹¶ä¼šé­é‡æ€§èƒ½ç“¶é¢ˆã€‚</p>
<blockquote>
<p>ä»¥Juejinä¸ºä¾‹ï¼Œåªè¦æˆ‘æŒç»­åˆ›ä½œè¯»è€…æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œæˆ‘ç›¸ä¿¡ç»ˆæœ‰ä¸€å¤©ä¼šè§£é”Lv10çº§ä½œè€…ï¼Œé‚£ä¹ˆï¼š</p>
<p>"åœ¨APPä¸Šç»™æˆ‘é¢å‘ä¸€ä¸ªä¼šé—ªçƒçš„å¾½ç« ï¼Œå¹¶è¿½åŠ åœ¨æ˜µç§°åï¼Œä»¥æ˜¾ç¤ºèº«ä»½"ï¼ŒåŒ…æ‹¬ä¸é™äºï¼šæˆ‘çš„ä¸»é¡µã€æ–‡ç« ä½œè€…æ ã€è¯„è®ºåŒºã€æ–‡ç« ä¸­ @æˆ‘ çš„åœ°æ–¹</p>
<p>è¿™ä¸ªåŠŸèƒ½ä¼¼ä¹å¾ˆåˆæƒ…åˆç†ğŸ˜†ã€‚</p>
</blockquote>
<p>ç”¨ImageSpanæ–¹æ¡ˆå®ç°è¿™ä¸€éœ€æ±‚ä¹Ÿå¾ˆåˆç†ï¼Œå¹¶ä¸”è¿™ä¸€è§£æã€å±•ç¤ºæ–¹æ¡ˆå¯ä»¥å¤šå¤„å¤ç”¨ï¼Œå¹¶ä¸éœ€è¦å››å¤„ç²¾å¿ƒç»´æŠ¤å¸ƒå±€ã€‚<em>è™½ç„¶juejinå¹¶æœªè¿™æ ·åšğŸ˜‚</em></p>
<p><em>ç®€å•ç›˜ç®—åï¼Œä»Šå¤©çš„çŸ¥è¯†ä¸€å®šæœ‰ä½¿ç”¨çš„å‰æ™¯ï¼Œç¨³èµšä¸äºï¼</em></p>
<h2 id="åˆ¶é€ ä¸€ä¸ªç¿»è½¦ç°åœº"><a class="header" href="#åˆ¶é€ ä¸€ä¸ªç¿»è½¦ç°åœº">åˆ¶é€ ä¸€ä¸ªç¿»è½¦ç°åœº</a></h2>
<p>è¿˜æ˜¯å€ŸåŠ©å…ˆå‰çš„é¡¹ç›®ï¼š<a href="https://github.com/leobert-lan/DrawableWorkShop">DrawableWorkShop</a> ï¼Œå…ˆåˆ¶ä½œä¸€ä¸ªç¿»è½¦ç°åœºã€‚</p>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åŠ¨ç”»Drawableï¼Œæ­£å¥½åˆ©ç”¨å®ƒç”ŸæˆImageSpanã€‚æˆ‘ä»¬å†å¢åŠ DrawableStart ç”¨ä½œå¯¹æ¯”ã€‚</p>
<p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-kotlin">val tvSpan = findViewById&lt;TextView&gt;(R.id.tv_span)

val drawable = createADrawable()
val imgSpan = ImageSpan(drawable)

val ss = SpannableString("ImageSpan *")
ss.setSpan(imgSpan, 10, 11, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE)
tvSpan.text = ss

val drawableStart = createADrawable()
tvSpan.setCompoundDrawables(drawableStart, null, null, null)

tvSpan.setOnClickListener {
    drawable.start()
    drawableStart.start()
}

fun createADrawable(): AnimLetterDrawable2 {
    val drawable = AnimLetterDrawable2()
    drawable.textSize = 20f
    drawable.letters = "span"
    drawable.setBounds(0, 0, 100, 100)
    return drawable
}
</code></pre>
<p>ç‚¹å‡»TextViewå¼€å¯åŠ¨ç”»ï¼Œå¥½ï¼Œæœç„¶ç¿»è½¦äº†ï¼ImageSpanå¹¶æœªåŠ¨èµ·æ¥ï¼Œè€ŒDrawableStartåŠ¨èµ·æ¥äº†ã€‚</p>
<h2 id="æ¸©æ•…è€ŒçŸ¥æ–°----åŸå› åˆ†æ"><a class="header" href="#æ¸©æ•…è€ŒçŸ¥æ–°----åŸå› åˆ†æ">æ¸©æ•…è€ŒçŸ¥æ–° -- åŸå› åˆ†æ</a></h2>
<p>åœ¨å‰ä¸¤ç¯‡ç›¸å…³æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»çª¥æ¢åˆ°åŠ¨ç”»çš„åŸç†ï¼š</p>
<blockquote>
<p>æŒ‰ç…§ç‰¹å®šçš„æ—¶é—´åºåˆ—ç»˜åˆ¶å¯¹åº”å¸§ï¼Œåˆ©ç”¨è§†è§‰æš‚ç•™å½¢æˆåŠ¨ç”»æ•ˆæœ</p>
</blockquote>
<p>æ— è®ºæ˜¯æ§ä»¶çš„å±æ€§åŠ¨ç”»ã€è¿˜æ˜¯DrawableåŠ¨ç”»ï¼Œå…¶æœ¬è´¨å‡ä¸ºæ­¤ã€‚åœ¨å‰ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«ç”¨äº†ä¸¤ç§æ–¹å¼é©±åŠ¨Drawableå½¢æˆåŠ¨ç”»æ•ˆæœï¼Œç¨ä½œå¤ä¹ ï¼š</p>
<ul>
<li>åŸºäº <code>Drawable#scheduleSelf</code> APIï¼Œå‘å®¿ä¸»View <code>Post</code> ä¸€ä¸ªå»¶è¿Ÿæ‰§è¡Œçš„ <code>Runnable</code> ä¸šåŠ¡é€»è¾‘ä¸ºé‡æ–°ç»˜åˆ¶ã€‚åœ¨Handleræ¶ˆæ¯æœºåˆ¶çš„é©±åŠ¨ä¸‹, <code>Choreographer</code> å®ç°äº†åŠ¨ç”»åŸºæœ¬åŸç†</li>
<li>åŸºäº <code>ValueAnimator</code>ï¼ŒæŒ‰ç…§æ—¶åºæ‰§è¡Œå›è°ƒï¼Œä¸šåŠ¡é€»è¾‘ä¸ºé‡æ–°ç»˜åˆ¶ã€‚ä¾æ—§æ˜¯å€ŸåŠ©Handleræ¶ˆæ¯æœºåˆ¶çš„é©±åŠ¨, <code>Choreographer</code> å®ç°åŠ¨ç”»åŸºæœ¬åŸç†ã€‚</li>
</ul>
<p>æ­¤æ—¶ï¼Œå¯ä»¥åšå‡ºå¤§èƒ†çš„å‡è®¾ï¼š<strong>é—®é¢˜æœ¬è´¨æ˜¯æ²¡æœ‰æ­£ç¡®é‡æ–°ç»˜åˆ¶</strong>ã€‚</p>
<p>åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒDrawableé‡æ–°ç»˜åˆ¶çš„æ ¸å¿ƒæ˜¯ <code>invalidateSelf()</code>ï¼š</p>
<pre><code class="language-java">class Drawable {
    public void invalidateSelf() {
        final Callback callback = getCallback();
        if (callback != null) {
            callback.invalidateDrawable(this);
        }
    }
}
</code></pre>
<p>è€Œè¯¥APIå€ŸåŠ©äº† <code>Drawable.Callback</code> å§”æ‰˜å®ç°ã€‚</p>
<p>Debugä¹‹åå¯ä»¥å‘ç°ï¼Œ<strong>é…åˆImageSpanä½¿ç”¨æ—¶ï¼ŒDrawableå¹¶æœªæŒæœ‰Callbackå®ä¾‹</strong> ã€‚</p>
<p>å¯¹æ¯”å‚è€ƒTextViewè®¾ç½®DrawableStartçš„ç›¸å…³æ ¸å¿ƒä»£ç ï¼Œå¿½ç•¥æ‰æ— å…³ç»†èŠ‚ï¼Œå…¶ä¸­è°ƒç”¨äº† <code>Drawable#setCallback(this)</code> ï¼š</p>
<pre><code class="language-java">class TextView {
    private void setRelativeDrawablesIfNeeded(Drawable start, Drawable end) {
        boolean hasRelativeDrawables = (start != null) || (end != null);
        if (hasRelativeDrawables) {
            //ignore 
            if (start != null) {
                //ignore

                //é‡ç‚¹
                start.setCallback(this);

                //ignore
            } else {
                dr.mDrawableSizeStart = dr.mDrawableHeightStart = 0;
            }
            if (end != null) {
                //ignore
                end.setCallback(this);

                //ignore
            } else {
                dr.mDrawableSizeEnd = dr.mDrawableHeightEnd = 0;
            }
            //ignore
        }
    }
}
</code></pre>
<p>è‡³æ­¤ï¼Œæ¨æµ‹å¾—åˆ°éªŒè¯ã€‚</p>
<h2 id="ç›´é¢é—®é¢˜----ä»¥æœ€ç®€å•çš„ä»£ç è®©imagespanåŠ¨èµ·æ¥"><a class="header" href="#ç›´é¢é—®é¢˜----ä»¥æœ€ç®€å•çš„ä»£ç è®©imagespanåŠ¨èµ·æ¥">ç›´é¢é—®é¢˜ -- ä»¥æœ€ç®€å•çš„ä»£ç è®©ImageSpanåŠ¨èµ·æ¥</a></h2>
<p>æ‰æ€æ•æ·çš„è¯»è€…å¯èƒ½å·²ç»æƒ³åˆ°ï¼Œç»™ImageSpanå†…éƒ¨çš„Drawableè®¾ç½®Callbackä¸å°±å¯ä»¥äº†å—ï¼Ÿå°±åƒè¿™æ ·ï¼š</p>
<pre><code class="language-kotlin"> tvSpan.setOnClickListener {
    //è®¾ç½®Callback
    drawable.callback = it

    drawable.start()
    //å±è”½æ‰DrawableStartçš„å¹²æ‰°
    // drawableStart.start()
}
</code></pre>
<img width="220" alt="æ²¡æœ‰é—®é¢˜" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ecbfafbe0104f23b8db06e31446195a~tplv-k3u1fbpfcp-watermark.image?"/>
<p>å½“ä½ è‡ªä¿¡æ»¡æ»¡çš„å°è¯•äº†ä¸€ä¸‹ï¼Œå“å‘€ï¼ŒåˆTMç¿»è½¦äº†ï¼ï¼ï¼</p>
<img width="220" alt="å…¨æ˜¯é—®é¢˜" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4959e7c21de4b7e8d41173c53210dbc~tplv-k3u1fbpfcp-watermark.image?"/>
<h3 id="ç¿»è½¦åŸå› "><a class="header" href="#ç¿»è½¦åŸå› ">ç¿»è½¦åŸå› </a></h3>
<p>è®©æˆ‘ä»¬å†å¤ä¹ ä¸€ä¸‹ï¼š</p>
<pre><code class="language-java">public class View {
    public void invalidateDrawable(@NonNull Drawable drawable) {
        //çœ‹è¿™é‡Œçš„æ ¡éªŒ
        if (verifyDrawable(drawable)) {
            final Rect dirty = drawable.getDirtyBounds();
            final int scrollX = mScrollX;
            final int scrollY = mScrollY;

            //è¿™é‡Œæ˜¯åˆ·æ–°
            invalidate(dirty.left + scrollX, dirty.top + scrollY,
                    dirty.right + scrollX, dirty.bottom + scrollY);
            rebuildOutline();
        }
    }

    protected boolean verifyDrawable(@NonNull Drawable who) {
        // Avoid verifying the scroll bar drawable so that we don't end up in
        // an invalidation loop. This effectively prevents the scroll bar
        // drawable from triggering invalidations and scheduling runnables.
        return who == mBackground || (mForegroundInfo != null &amp;&amp; mForegroundInfo.mDrawable == who)
                || (mDefaultFocusHighlight == who);
    }
}
</code></pre>
<p>å¾ˆæ˜¾ç„¶ï¼ŒImageSpanå†…åŒ…å«çš„Drawableå’ŒTextViewä¹‹é—´å¹¶æ— ç›´æ¥å…³è”ï¼</p>
<p><em>æ³¨æ„,TextViewçš„åˆ¤æ–­é€»è¾‘å­˜åœ¨é‡è½½ï¼Œä»…èƒŒæ™¯ã€èšç„¦æ•ˆæœã€DrawableStartã€DrawableTopã€DrawableEndã€DrawableBottom æ˜¯æœ‰å…³è”çš„ï¼š</em></p>
<pre><code class="language-java">class TextView {
    protected boolean verifyDrawable(@NonNull Drawable who) {
        final boolean verified = super.verifyDrawable(who);
        if (!verified &amp;&amp; mDrawables != null) {
            for (Drawable dr : mDrawables.mShowing) {
                if (who == dr) {
                    return true;
                }
            }
        }
        return verified;
    }
}
</code></pre>
<h3 id="æš—åº¦é™ˆä»“ç»•è¿‡æ ¡éªŒ"><a class="header" href="#æš—åº¦é™ˆä»“ç»•è¿‡æ ¡éªŒ">æš—åº¦é™ˆä»“ï¼Œç»•è¿‡æ ¡éªŒ</a></h3>
<p>æ‰æ€æ•æ·çš„è¯»è€…æœ‹å‹ä¸€å®šæƒ³åˆ°äº†ï¼š"æ—¢ç„¶æ˜¯æ ¡éªŒå‡ºçš„é—®é¢˜ï¼Œé‚£æˆ‘ç»•è¿‡æ ¡éªŒä¸å°±å¥½äº†"ï¼Œå¾ˆå¿«æå‡ºäº†ä»£ç V2ï¼š</p>
<pre><code class="language-kotlin">tvSpan.setOnClickListener {
//            drawable.callback = it //è¿™ç§æ–¹å¼æ— æ•ˆï¼ŒDrawableå’ŒTextViewä¹‹é—´æ— å…³è”
    drawable.callback = object : Drawable.Callback {
        override fun invalidateDrawable(who: Drawable) {
            //ç›´æ¥åˆ·ï¼Œç»•è¿‡æ ¡éªŒ
            it.invalidate()
        }

        override fun scheduleDrawable(who: Drawable, what: Runnable, `when`: Long) {
            it.scheduleDrawable(who, what, `when`)
        }

        override fun unscheduleDrawable(who: Drawable, what: Runnable) {
            it.unscheduleDrawable(who, what)
        }

    }
    drawable.start()
//            drawableStart.start()
}
</code></pre>
<img width="220" alt="æ²¡æœ‰é—®é¢˜" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ecbfafbe0104f23b8db06e31446195a~tplv-k3u1fbpfcp-watermark.image?"/>
<p>æœç„¶ï¼Œå®ƒåŠ¨èµ·æ¥äº†ï¼</p>
<p><em>ä½œè€…æŒ‰ï¼šè®©ImageSpanåŠ¨èµ·æ¥çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œåˆ°æ­¤å·²ç»ç»“æŸï¼Œä½†çŸ¥è¯†çš„æ¢ç´¢è¿˜æœªç»“æŸï¼Œä¸‹é¢å°†æ‰“å¼€Spanä¸–ç•Œçš„å¤§é—¨</em></p>
<h2 id="ä¼˜é›…æ°¸æ’çš„è¿½æ±‚"><a class="header" href="#ä¼˜é›…æ°¸æ’çš„è¿½æ±‚">ä¼˜é›…ï¼Œæ°¸æ’çš„è¿½æ±‚</a></h2>
<blockquote>
<p>æˆ‘ä¸€ç›´è¿½æ±‚ç¼–ç¨‹ä¸­çš„ä¸€ç§ä¼˜é›…ï¼š</p>
<ul>
<li>å¤æ‚åº¦æŒ‰å¿…è¦ç¨‹åº¦åˆ†å±‚å±•å¼€ï¼Œé¿å… æ²¡æœ‰å¿…è¦çš„è¯¦ç»†å¯¼è‡´éš¾ä»¥ç†è§£çš„å¤æ‚</li>
<li>äº•ç„¶æœ‰åºï¼Œå½“ä»£ç ä¸å¾—ä¸åšå‡ºæ”¹å˜æ—¶ï¼Œä¸å› ä»£ç é—´æ²¡å¿…è¦çš„è€¦åˆï¼ŒåŠ å¤§å˜åŒ–éš¾åº¦</li>
</ul>
<p>è€Œæˆ‘ä»¬ç›®å‰é¢å¯¹çš„é—®é¢˜ï¼Œæ°æ°å°±æ˜¯ä¸€ä¸ªå¥½æœºä¼šï¼Œå¯ä»¥é¡ºåŠ¿ç ”ç©¶æºç ï¼Œæ±²å–çŸ¥è¯†ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå°è£…ä»£ç ï¼Œæ›´ä¼˜é›…åœ°è§£å†³é—®é¢˜ï¼›å¹¶ä¸”åœ¨ç ”ç©¶çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ‘¸ç´¢åˆ°å…¶å®ƒçŸ¥è¯†æ¨¡å—ã€‚</p>
<p>è¿™æ°å¥½å¯ä»¥é€šå¾€ç¬¬ä¸‰å¢ƒ <em>å¯¹äº <code>äººç”Ÿè¿½æ±‚ä¸‰å¢ƒ</code> ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ä¸ªæ‚ç¯‡å’Œè¯»è€…ä»¬äº¤æµä¸€ä¸‹å¿ƒå¾—</em></p>
</blockquote>
<h3 id="ç›´æ¥ä½¿ç”¨ä¼šå¸¦æ¥çš„é—®é¢˜"><a class="header" href="#ç›´æ¥ä½¿ç”¨ä¼šå¸¦æ¥çš„é—®é¢˜">ç›´æ¥ä½¿ç”¨ä¼šå¸¦æ¥çš„é—®é¢˜</a></h3>
<h4 id="1è™½ç„¶æœ‰æ•ˆä½†è€¦åˆè¿‡é‡ä¸šåŠ¡ä»£ç ä¸­ä¸å¾—ä¸æš´éœ²è¿‡å¤šæ— å…³ä»£ç "><a class="header" href="#1è™½ç„¶æœ‰æ•ˆä½†è€¦åˆè¿‡é‡ä¸šåŠ¡ä»£ç ä¸­ä¸å¾—ä¸æš´éœ²è¿‡å¤šæ— å…³ä»£ç ">1.è™½ç„¶æœ‰æ•ˆï¼Œä½†è€¦åˆè¿‡é‡ï¼Œä¸šåŠ¡ä»£ç ä¸­ä¸å¾—ä¸æš´éœ²è¿‡å¤šæ— å…³ä»£ç </a></h4>
<p>æˆ‘ä»¬å·²ç»ä½¿ImageSpanåŠ¨èµ·æ¥äº†ï¼Œé‚£æˆ‘å¤šæå‡ ä¸ªåŠ¨æ€å¾½ç« æ²¡æœ‰é—®é¢˜å§ã€‚</p>
<p>å°†æ ¸å¿ƒä»£ç å¤åˆ»ï¼Œå¾ˆå¿«å°±å¾—åˆ°äº†ä»¥ä¸‹ä»£ç </p>
<img width="220" alt="æ²¡æœ‰é—®é¢˜" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ecbfafbe0104f23b8db06e31446195a~tplv-k3u1fbpfcp-watermark.image?"/>
<pre><code class="language-kotlin">val tvSpan2 = findViewById&lt;TextView&gt;(R.id.tv_span2)
val infoBuilder = SpannableStringBuilder().append("Leobert")

val madels = arrayListOf&lt;String&gt;("Lv.10", "æŒç»­åˆ›é€ ", "ç¬”è€•ä¸è¿½", "å¤œä»¥ç»§æ—¥")
val drawables: List&lt;AnimLetterDrawable2&gt; = madels.map { madel -&gt;
    appendMadel(infoBuilder, madel).let { drawable -&gt;
        drawable.callback = object : Drawable.Callback {
            override fun invalidateDrawable(who: Drawable) {
                tvSpan2.invalidate()
            }
            //ignore
        }
        drawable
    }
}

tvSpan2.text = infoBuilder
tvSpan2.setOnClickListener {
    drawables.forEach {
        it.start()
    }
}

fun appendMadel(builder: SpannableStringBuilder, madel: String): AnimLetterDrawable2 {
    val drawable = AnimLetterDrawable2()
    //ignore

    val imgSpan = ImageSpan(drawable)
    val ss = SpannableString(" *")
    ss.setSpan(imgSpan, 1, 2, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE)
    builder.append(ss)

    //ignoreï¼Œè¿½åŠ äº†ä¸€å¤„ClickSpanï¼Œå¯ä»¥ç›´è§‚è§‚æµ‹ç‚¹å‡»è§¦å‘

    return drawable
}
</code></pre>
<p>æ‚¨å·²ç»å‘ç°ï¼Œä¸ºäº†è®©åŠŸèƒ½æœ‰æ•ˆï¼Œæˆ‘ä»¬ä¸å¾—ä¸å°å¿ƒçš„è®¾ç½®å›è°ƒï¼Œä¸€æ—¦æœ‰æ‰€ç–æ¼ï¼Œå°±ä¼šå¸¦æ¥Bugã€‚</p>
<blockquote>
<p>åŠ¡å¿…æ³¨æ„ï¼Œä»…ç”¨äºæ˜¾ç¤ºæ—¶ï¼Œæˆ‘ä»¬å°šå¯ä»¥è¯´æœè‡ªå·±ä¸è´Ÿè´£ä»»åœ°å¿½ç•¥ "ä¸ç§»é™¤å›è°ƒ" å¸¦æ¥çš„è´Ÿé¢å½±å“ï¼Œè¯¸å¦‚æ— æ•ˆåˆ·æ–°ã€å†…å­˜æ³„éœ²ã€‚</p>
<p>è€Œåœ¨ç¼–è¾‘æ—¶ï¼ˆå¦‚EditTextä¸­ä½¿ç”¨ï¼Œå¹¶åˆ é™¤å›¾ç‰‡ï¼‰ã€ä»¥åŠRecycleViewä¸­TextViewå¤ç”¨ï¼ˆæ¨å¹¿åˆ°å¯æ›¿æ¢å‘ˆç°å†…å®¹çš„æƒ…å†µï¼‰
åˆ™ä¸å¾—ä¸ç§»é™¤å›è°ƒã€‚å¦åˆ™è½»åˆ™é€ æˆæ€§èƒ½æŸè€—å’Œå†…å­˜æ³„éœ²ï¼Œé‡åˆ™ç«‹ç° UI bugã€‚</p>
</blockquote>
<p><strong>å¯ä»¥æƒ³è±¡ï¼Œè¿™æ ·çš„ä»£ç å¤ªè¿‡äºä¸‘é™‹ï¼Œè¿‡å¤šçš„æ— å…³ä»£ç æš´éœ²åœ¨ä¸šåŠ¡å®ç°ä¸­</strong>ã€‚</p>
<h4 id="2å½±å“å¤ç”¨"><a class="header" href="#2å½±å“å¤ç”¨">2.å½±å“å¤ç”¨</a></h4>
<p>Callbackçš„å”¯ä¸€æ€§å¯¼è‡´ImageSpanä¸èƒ½è¢«æœ‰æ•ˆå¤ç”¨ï¼Œè¿˜éœ€è¦è¿›è¡Œä¸€å®šçš„æ”¹é€ ã€‚</p>
<p>è™½ç„¶åœ¨ç†è®ºä¸Šå·²ç»æ¨æ–­å‡ºè¿™ç§åšæ³•ä¼šå½±å“Drawableå¤ç”¨ï¼ˆä»¥åŠSpançš„å¤ç”¨ã€è¿›ä¸€æ­¥æ¨å¹¿åˆ°Spannableçš„å¤ç”¨ï¼‰ï¼Œä»æ—§ä»¥ä»£ç éªŒè¯ä¸€ä¸‹æ¨è®ºï¼š</p>
<pre><code class="language-kotlin">val tvSpan3 = findViewById&lt;TextView&gt;(R.id.tv_span3)
// æ²¿ç”¨ä¸Šæ–‡ä¸­æ„å»ºçš„Spannableï¼Œå®ƒå·²ç»é€šè¿‡Callbackå’ŒtvSpan2é«˜åº¦è€¦åˆï¼Œ
// æˆ‘ä»¬å¸Œæœ›è¿™æ ·çš„ä»£ç å°±å¯ä»¥å®Œæˆç›®æ ‡ï¼Œä½†æ˜¾ç„¶ç›®å‰æ— æ³•å®Œæˆ
tvSpan3.text = infoBuilder
tvSpan3.setOnClickListener {
    drawables.forEach {
        it.start()
    }
}
tvSpan3.movementMethod = LinkMovementMethod.getInstance()
</code></pre>
<p>è¯»è€…è¯¸å›å¯ä½¿ç”¨WorkShopè‡ªè¡Œå°è¯•ï¼Œä¸å‡ºæ„å¤–çš„ç¿»è½¦äº†å§ã€‚</p>
<h3 id="1è§£å†³callbackå¯¹å¤ç”¨çš„é™åˆ¶"><a class="header" href="#1è§£å†³callbackå¯¹å¤ç”¨çš„é™åˆ¶">1.è§£å†³Callbackå¯¹å¤ç”¨çš„é™åˆ¶</a></h3>
<p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬æ— æ³•ä¿®æ”¹SDKçš„å†…å®¹ï¼Œä½†å¯ä»¥ä½¿ç”¨ç»„åˆæ¨¡å¼ã€‚</p>
<p>å…ˆå®šä¹‰ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œä¾èµ–æŠ½è±¡ä»¥è§£è€¦ã€‚</p>
<pre><code class="language-kotlin">interface OnRefreshListener {
    /**
     * will be called when a inner drawable of the span want to invalidate.
     *
     * @return true if the listener want to be called in future.
     * false otherwise
     */
    fun onRefresh(): Boolean
}
</code></pre>
<p>å®šä¹‰ç»„åˆï¼Œä»æ—§ä»¥æ¥å£å®šä¹‰ï¼Œä»¥æå‡çµæ´»åº¦ï¼š</p>
<pre><code class="language-kotlin">interface OnRefreshListeners : OnRefreshListener {
    fun addRefreshListener(callback: OnRefreshListener)
    fun removeRefreshListener(callback: OnRefreshListener)
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥é¡ºå…¶è‡ªç„¶çš„å®šä¹‰ä¸€ä¸ªç»„åˆCallbackå®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-kotlin">class DrawableCallbackComposer : OnRefreshListeners, Drawable.Callback {
    private val mRefreshListeners: MutableCollection&lt;OnRefreshListener&gt; = mutableListOf()

    override fun addRefreshListener(callback: OnRefreshListener) {
        mRefreshListeners.add(callback)
    }

    override fun removeRefreshListener(callback: OnRefreshListener) {
        mRefreshListeners.remove(callback)
    }

    override fun onRefresh(): Boolean {
        val stillActivatedAfterRefresh = mRefreshListeners.filter {
            it.onRefresh()
        }
        mRefreshListeners.clear()
        mRefreshListeners.addAll(stillActivatedAfterRefresh)
        return true
    }

    override fun unscheduleDrawable(who: Drawable, what: Runnable) {
    }

    override fun invalidateDrawable(who: Drawable) {
        onRefresh()
    }

    override fun scheduleDrawable(who: Drawable, what: Runnable, `when`: Long) {
    }
}
</code></pre>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ <code>DrawableCallbackComposer</code> æ¥æ‰©å±•å¤ç”¨åº¦ï¼Œä½†æ˜¾ç„¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ„¿æ„åˆ°å¤„è£¸éœ² <code>DrawableCallbackComposer</code> çš„æ“ä½œï¼Œç»§ç»­è€ƒè™‘å°è£…å’Œéšè—ã€‚</p>
<h3 id="2æä»£æ¡ƒåƒµåˆ©ç”¨ä»£ç†"><a class="header" href="#2æä»£æ¡ƒåƒµåˆ©ç”¨ä»£ç†">2.æä»£æ¡ƒåƒµï¼Œåˆ©ç”¨ä»£ç†</a></h3>
<p>å¦‚æœæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªä»£ç†å±‚ï¼Œå®ƒå¸®åŠ© Drawable å¤„ç† <code>DrawableCallbackComposer</code> çš„ <code>å­èŠ‚ç‚¹ OnRefreshListener</code> æ³¨å†Œä¸è§£æ³¨å†Œï¼Œå¹¶ä¸”æœ€ç»ˆè¡¨ç°ä¸ºä¸€ä¸ª Drawableï¼Œé‚£ä¹ˆ <code>è£¸éœ²çš„æ§åˆ¶ä»£ç </code>
å°†æ›¿æ¢ä¸ºç®€å•çš„ <code>ä¾èµ–æ³¨å…¥ä¸­çš„å®ä¾‹æä¾›</code></p>
<p>åŸºäºæ¥å£çš„çµæ´»æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é¡ºå…¶è‡ªç„¶çš„å®šä¹‰å¦‚ä¸‹ <code>DrawableProxy</code> ç±»ã€‚</p>
<p><em>å®ƒèƒ½å¤Ÿç›´æ¥ä»£ç†åŸDrawableå…³äºç»˜åˆ¶çš„å…¨éƒ¨å†…å®¹ï¼Œåˆè¿½åŠ äº† ä½¿ç”¨ DrawableCallbackComposer å’Œ å›è°ƒæ³¨å†Œè§£æ³¨å†Œçš„å¿…è¦æ§åˆ¶é€»è¾‘</em></p>
<pre><code class="language-kotlin">class DrawableProxy
@JvmOverloads constructor(
    proxy: Drawable? = null,
    private val drawableCallbackComposer: DrawableCallbackComposer = DrawableCallbackComposer()
) : Drawable(),
    ResizeDrawable,
    Drawable.Callback by drawableCallbackComposer,
    OnRefreshListeners by drawableCallbackComposer {

    private var proxySafety: Drawable = proxy?.also { it.callback = drawableCallbackComposer } ?: this
        set(drawable) {
            field.callback = null
            drawable.callback = drawableCallbackComposer
            field = drawable
            needResize = true
            invalidateDrawable(this)
        }

    fun setProxy(drawable: Drawable) {
        this.proxySafety = drawable
    }

    fun clearProxy() {
        this.proxySafety = this
    }

    override var needResize: Boolean = false

    /*ä»¥ä¸‹æ˜¯ä»£ç†å®ç°ï¼Œæ— éœ€è¿‡åº¦å…³å¿ƒ*/

    override fun getIntrinsicWidth(): Int {
        return proxySafety.intrinsicWidth
    }

    override fun getIntrinsicHeight(): Int {
        return proxySafety.intrinsicHeight
    }

    override fun draw(canvas: Canvas) {
        proxySafety.draw(canvas)
    }

    override fun setAlpha(alpha: Int) {
        proxySafety.alpha = alpha
    }

    override fun setColorFilter(cf: ColorFilter?) {
        proxySafety.colorFilter = cf
    }

    override fun getOpacity(): Int {
        return proxySafety.opacity
    }

    override fun onBoundsChange(bounds: Rect) {
        super.onBoundsChange(bounds)
        needResize = false
    }

    override fun setBounds(bounds: Rect) {
        super.setBounds(bounds)
        proxySafety.bounds = bounds
    }

    override fun setBounds(left: Int, top: Int, right: Int, bottom: Int) {
        super.setBounds(left, top, right, bottom)
        proxySafety.setBounds(left, top, right, bottom)
    }

}
</code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>DrawableProxy</code> æ›¿ä»£åŸå…ˆçš„ AnimDrawable,ç”¨ä»¥æ„å»ºSpanå®ä¾‹ã€‚</p>
<p>æ¥ä¸‹æ¥å¯ä»¥å°†æ³¨æ„åŠ›è½¬ç§»åˆ°ï¼š"å®ç°ã€æ·»åŠ  OnRefreshListener"ï¼Œé€šè¿‡è°ƒç”¨å®¿ä¸»TextViewçš„åˆ·æ–°ï¼Œæ˜¾ç¤ºåŠ¨ç”»å¸§ã€‚</p>
<h3 id="ç»§ç»­ä½¿ç”¨spanwatcherè§£æ”¾åŒæ‰‹"><a class="header" href="#ç»§ç»­ä½¿ç”¨spanwatcherè§£æ”¾åŒæ‰‹">ç»§ç»­ä½¿ç”¨SpanWatcherè§£æ”¾åŒæ‰‹</a></h3>
<p>è¡Œè‡³æ­¤å¤„ï¼Œæ‚¨ä¸€å®šä¸ç”˜å¿ƒå†åœ¨ä¸šåŠ¡ä»£ç ä¸­è£¸éœ²æ­¤ç±»æ§åˆ¶ä»£ç ï¼š</p>
<pre><code class="language-kotlin">drawable?.addRefreshListener(object : OnRefreshListener {
    override fun onRefresh(): Boolean {
        //ignore è¯¸å¦‚ç”Ÿå‘½å‘¨æœŸæ–­å®š ã€‚ã€‚ã€‚
        view.invalidate()
        return true
    }
})
</code></pre>
<p>å“ªæ€•æ‚¨å°†å®ƒå°è£…æˆä¸€ä¸ªé™æ€APIä»¥ä¾›ä¸šåŠ¡ä»£ç ä¸­è°ƒç”¨ï¼Œä¹Ÿéš¾ä»¥è¾¾åˆ°æ‚¨å¯¹ è¿½æ±‚"ä¼˜é›…" çš„è¦æ±‚åº•çº¿äº†ã€‚</p>
<p>è€ŒSDKä¸­å·²ç»ç¡®å®šäº†è¿™ä½å¤©é€‰æ‰“å·¥äºº <code>SpanWatcher</code>ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„å®šä¹‰ï¼š</p>
<pre><code class="language-java">/**
 * When an object of this type is attached to a Spannable,
 * its methods will be called to notify it that other 
 * markup objects have been added, changed, or removed.
 * */
</code></pre>
<p>ç¿»è¯‘å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å½“ <code>SpanWatcher</code> ç±»å‹çš„å®ä¾‹è¢«æ·»åŠ åˆ° <code>Spannable</code> ä¹‹åï¼Œä¸€æ—¦å‘ç”Ÿ ï¼ˆSpanï¼‰æ ‡è®°è¢« æ·»åŠ ã€æ”¹å˜ã€ç§»é™¤æ—¶ï¼Œ
å®ä¾‹ç›¸åº”çš„ APIæ–¹æ³• ä¼šè¢«è°ƒç”¨ï¼Œèµ·åˆ°é€šçŸ¥æ•ˆæœã€‚</p>
</blockquote>
<p>è—‰æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é¡ºå…¶è‡ªç„¶åœ°ç®€åŒ–å¤„ç†å›è°ƒçš„æ³¨å†Œä¸è§£æ³¨å†Œ</p>
<p><em>è¯»è€…è¯¸å›ï¼Œæ­¤æ—¶è¿˜è¯·å†æƒ³ä¸€æƒ³ï¼Œå®ƒèƒ½å®Œç¾çš„è§£å†³é—®é¢˜å—ï¼Ÿ</em></p>
<pre><code class="language-kotlin">class AnimImageSpanWatcher(view: View) : SpanWatcher, OnRefreshListener {
    private var mLastRefreshStamp: Long = 0
    private val mViewWeakReference: WeakReference&lt;View&gt; = WeakReference(view)

    override fun onSpanAdded(text: Spannable, what: Any, start: Int, end: Int) {
        if (what is RefreshSpan) {
            val drawable = what.getInvalidateDrawable()
            drawable?.addRefreshListener(this)
        }
    }

    override fun onSpanRemoved(text: Spannable, what: Any, start: Int, end: Int) {
        if (what is RefreshSpan) {
            val drawable = what.getInvalidateDrawable()
            drawable?.removeRefreshListener(this)
        }
    }

    override fun onSpanChanged(text: Spannable, what: Any, ostart: Int, oend: Int, nstart: Int, nend: Int) {

    }

    override fun onRefresh(): Boolean {
        val view = mViewWeakReference.get() ?: return false

        //ignore ç”Ÿå‘½å‘¨æœŸæœ‰æ•ˆæ€§åˆ¤æ–­

        val currentTime = System.currentTimeMillis()
        //åŠ ä¸€å±‚è¿‡æ»¤ï¼Œé¿å…åˆ·æ–°è¿‡äºé¢‘ç¹
        if (currentTime - mLastRefreshStamp &gt; REFRESH_INTERVAL) {
            mLastRefreshStamp = currentTime
            view.invalidate()
        }
        return true
    }

    companion object {
        private const val REFRESH_INTERVAL = 60
    }
}
</code></pre>
<blockquote>
<p>ä½œè€…æŒ‰ï¼šæ„Ÿè°¢ <a href="https://juejin.cn/user/835284568906152">é•¿å®‰çšˆæ•…é‡Œ</a> çš„æé†’ï¼Œæˆ‘é—æ¼äº†éƒ¨åˆ†ä»£ç ã€‚</p>
</blockquote>
<pre><code>interface RefreshSpan {
    fun getInvalidateDrawable(): OnRefreshListeners?
}
</code></pre>
<p>è¡Œè‡³æ­¤å¤„ï¼Œè¿˜å‰©ä¸‹å…³é”®çš„ä¸€æ­¥ï¼šå€ŸåŠ©TextViewè‡ªèº«çš„æœºåˆ¶ï¼Œè®©è¿™äº›ç±»æ­£å¸¸å·¥ä½œï¼</p>
<h3 id="ä½¿ç”¨-spannablefactory-æ¢¦å¹»è”åŠ¨"><a class="header" href="#ä½¿ç”¨-spannablefactory-æ¢¦å¹»è”åŠ¨">ä½¿ç”¨ <code>Spannable.Factory</code> æ¢¦å¹»è”åŠ¨</a></h3>
<p>ä¸æ¸…æ¥šè¯»è€…è¯¸å›æ˜¯å¦ <strong>ç²¾å¿ƒç ”è¯»</strong> è¿‡ <code>TextView</code> çš„æºç ï¼Œå½“ç„¶ï¼Œæœ¬ç¯‡å¹¶ä¸æ‰“ç®—å±•å¼€åˆ†æï¼ŒTextView ä¸­æœ‰ä¸€ä¸ªAPIï¼š</p>
<pre><code class="language-java">class TextView {
    /**
     * Sets the Factory used to create new Spannable
     */
    public final void setSpannableFactory(Spannable.Factory factory) {
        mSpannableFactory = factory;
        setText(mText);
    }
}
</code></pre>
<p>é€šè¿‡APIå®ç°ï¼Œæ‚¨å¯ä»¥å‘ç°ï¼Œå®ƒä¼šé‡æ–°è°ƒç”¨ setText APIï¼Œå¹¶åˆ©ç”¨è¯¥ Factory åˆ›å»ºç”¨äºæ˜¾ç¤ºçš„ Spannable</p>
<p><code>Spannable.Factory</code>ï¼š</p>
<pre><code class="language-java">/**
 * Factory used by TextView to create new Spannables.
 * You can subclass it to provide something other than SpannableString.
 */
public static class Factory {
    //ignore

    /**
     * Returns a new SpannableString from the specified CharSequence.
     * You can override this to provide a different kind of Spannable.
     */
    public Spannable newSpannable(CharSequence source) {
        return new SpannableString(source);
    }
}
</code></pre>
<p>å€¼å¾—æ³¨æ„ï¼š</p>
<blockquote>
<p>è®¾è®¡Spannableçš„æ‹·è´æ—¶ï¼Œç†æ‰€å½“ç„¶å­˜åœ¨ä¸€äº›Spanä¸å¸Œæœ›è¢«æ‹·è´ï¼Œäºæ˜¯è®¾è®¡æœ‰è¯¥æœºåˆ¶ï¼Œå®ç° <code>NoCopySpan</code> çš„æ ‡è®°ï¼ˆspanï¼‰ä¸ä¼šè¢«æ‹·è´</p>
</blockquote>
<p>äºæ˜¯ï¼Œå¯å®ç°ç±»ä¼¼å¦‚ä¸‹å·¥å‚ç±»ï¼Œå®Œæˆæœ€åçš„è”åŠ¨ã€‚</p>
<pre><code class="language-kotlin">class CustomSpannableFactory(private val mNoCopySpans: List&lt;NoCopySpan&gt;) : Spannable.Factory() {

    override fun newSpannable(source: CharSequence): Spannable {
        val spannableStringBuilder = SpannableStringBuilder()
        mNoCopySpans.forEach {
            spannableStringBuilder.setSpan(
                it, 0, 0,
                Spanned.SPAN_INCLUSIVE_INCLUSIVE or Spanned.SPAN_PRIORITY
            )
        }
        spannableStringBuilder.append(source)
        return spannableStringBuilder
    }
}
</code></pre>
<p>æœ€ç»ˆï¼Œä»¥ä¼ªä»£ç å®ç°å±•ç°è°ƒç”¨ç»†èŠ‚å¦‚ä¸‹ï¼š</p>
<pre><code class="language-kotlin">val tvSpan = findViewById&lt;TextView&gt;(R.id.tv_span)

//ç¬¬ä¸€éƒ¨åˆ†
//å¦‚ä¸Šæ–‡ï¼Œåˆ›å»ºä¸€ä¸ªåŠ¨ç”»Drawable
val drawable = createADrawable()
//åŸºäºä»£ç†ï¼Œåˆ©ç”¨å®ƒç®€åŒ–Drawable.Callbackçš„å¤„ç†
val proxyDrawable = DrawableProxy(drawable)
//æ‚¨å¯ä»¥è®¤ä¸ºè¿™å°±æ˜¯ä¸€ä¸ªå®ç°äº†RefreshSpançš„ImageSpanï¼Œ
//å†…éƒ¨åšäº†ç­‰é«˜å¤„ç†ç­‰ï¼Œè¿™äº›å’Œæ–‡ç« ä¸»é¢˜æ— å…³ï¼Œç®€è¦ä»£ç é™„äºä¸‹æ–‡
val imgSpan = AnimIsohypseImageSpan(proxyDrawable)

//ç¬¬äºŒéƒ¨åˆ†
//æ„å»ºä¸€ä¸ªæ¼”ç¤ºç”¨çš„Spannable
val ss = SpannableString("ImageSpan *")
ss.setSpan(imgSpan, 10, 11, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE)
tvSpan.text = ss

//ç¬¬ä¸‰éƒ¨åˆ†
//ä½¿ç”¨Watcherç®€åŒ–å›è°ƒè®¾ç½®
val watchers = ArrayList&lt;NoCopySpan&gt;()
watchers.add(AnimImageSpanWatcher(tvSpan))
//ä½¿ç”¨è‡ªå®šä¹‰Factoryå®ç°è”åŠ¨
tvSpan.setSpannableFactory(CustomSpannableFactory(watchers))

//æ¼”ç¤ºæ‰‹åŠ¨è§¦å‘åŠ¨ç”»
tvSpan.setOnClickListener {
    drawable.start()
}
</code></pre>
<blockquote>
<p>ä½œè€…æŒ‰ï¼šæ„Ÿè°¢ <a href="https://juejin.cn/user/835284568906152">é•¿å®‰çšˆæ•…é‡Œ</a> çš„æé†’ï¼Œæˆ‘é—æ¼äº†éƒ¨åˆ†ä»£ç ã€‚</p>
</blockquote>
<p>å¦å¤–è¿˜æœ‰ä¸€éƒ¨åˆ†ä»£ç ï¼Œä»…ç”¨äºå‚è€ƒï¼Œè¯»è€…è¯¸å›éœ€è¦ç»“åˆè‡ªèº«é¡¹ç›®å®é™…æƒ…å†µè¿›è¡Œç±»ç°‡çš„æ‰©å±•</p>
<pre><code>//DrawableProxyä¸­ç”¨åˆ°
interface ResizeDrawable {
    var needResize: Boolean
}

interface IntegratedSpan

//ç­‰é«˜
open class IsohypseImageSpan : ImageSpan, IntegratedSpan {
    //æ„é€ å™¨å’Œç­‰é«˜è®¡ç®—ã€ç»˜åˆ¶ç­‰ç•¥

    open fun getResizedDrawable(): Drawable {
        val d = drawable
        if (drawableHeight == 0) {
            return d
        }
        if (!resized) {
            resized = true
            d.bounds = Rect(
                0, 0,
                (1f * drawableHeight.toFloat() * d.intrinsicWidth.toFloat() / d.intrinsicHeight).toInt(),
                drawableHeight
            )
        }
        return d
    }
}

//é…åˆè‡ªå®šä¹‰çš„SpanWatcher
open class AnimIsohypseImageSpan : IsohypseImageSpan, RefreshSpan {
    //æ„é€ å™¨ç•¥

    override fun getInvalidateDrawable(): OnRefreshListeners? {
        val d = getResizedDrawable()
        return if (d is OnRefreshListeners) {
            d
        } else {
            null
        }
    }
}

//ç”¨äºæœ‰é‡è®¡ç®—é«˜åº¦çš„éœ€æ±‚
class ResizeIsoheightImageSpan : AnimIsohypseImageSpan, RefreshSpan {
    //æ„é€ å™¨ç•¥

    override fun getResizedDrawable(): Drawable {
        val d = drawable
        if (drawableHeight == 0) {
            return d
        }
        if (d is ResizeDrawable &amp;&amp; (d.needResize || !resized)) {
            resizeSpan(d)
        } else if (!resized) {
            resizeSpan(d)
        }
        return d
    }

    private fun resizeSpan(d: Drawable) {
        resized = true
        d.bounds = Rect(0, 0,
                (1f * drawableHeight * d.intrinsicWidth / d.intrinsicHeight).toInt(),
                drawableHeight)
    }
}
</code></pre>
<p>å®é™…ä¸Šï¼Œåœ¨å·¥ç¨‹ä¸­åº”ç”¨æ—¶ï¼š</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬ä¼šä½¿ç”¨å·¥å‚ç±»+ä¾èµ–æ³¨å…¥å·¥å…·ï¼Œåœ¨ä¸šåŠ¡å±‚å±è”½æ‰ç»†èŠ‚</li>
<li>ç¬¬äºŒéƒ¨åˆ†ç•¥ï¼Œå¦‚ä½•æ„å»ºSpannableå¹¶åœ¨ä¸šåŠ¡å±‚å±è”½è¯¥ç»†èŠ‚ä¸æœ¬æ–‡æ— å…³</li>
<li>ç¬¬ä¸‰éƒ¨åˆ†ä¹Ÿå¯ä»¥å±è”½æ‰ä¸€äº›ç»†èŠ‚</li>
</ul>
<p>å¯ä»¥æƒ³è±¡çš„åˆ°ï¼Œä¸šåŠ¡å±‚å˜å¾—çº¯ç²¹äº†ï¼Œè€Œç»„ä»¶çš„ Ability å±‚ï¼ˆ<em>è¿™æ˜¯ç¬”è€…è‡ªè¡Œæœæ’°çš„å‘½åï¼Œç”¨äºæè¿°è‡ªå®šä¹‰çš„æ§ä»¶ã€åŠå…¶æ‹“å±•åŠŸèƒ½çš„ç±»</em>ï¼‰ä¹Ÿä¼šéå¸¸å¹²å‡€ï¼Œå‡å¯ä»¥åšåˆ°ä¾èµ–æŠ½è±¡ï¼ŒæŒ‰éœ€ä½¿ç”¨ï¼Œç®€åŒ–è€¦åˆã€‚</p>
<h3 id="æ•²å“è­¦é’Ÿ"><a class="header" href="#æ•²å“è­¦é’Ÿ">æ•²å“è­¦é’Ÿ</a></h3>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ–‡ç« å†™åˆ°è¿™ï¼ŒåŸºæœ¬æ˜¯ç»“æŸçš„èŠ‚å¥ï¼Œå¯èƒ½æ‚¨ä¹Ÿæ†‹äº†å¥½é•¿ä¸€å£æ°”æ‰çœ‹åˆ°è¿™é‡Œï¼Œæƒ³ç€å¯ä»¥ç¼“ä¸€å£æ°”äº†ã€‚</p>
<p>ç„¶è€Œæœ‰ä¸ªåæ¶ˆæ¯ä¸å¾—ä¸å‘Šè¯‰æ‚¨ï¼š<strong>å…¶å®é—®é¢˜å¹¶æ²¡æœ‰å®Œå…¨è§£å†³</strong>ï¼</p>
<img width="220" alt="å…¨æ˜¯é—®é¢˜" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4959e7c21de4b7e8d41173c53210dbc~tplv-k3u1fbpfcp-watermark.image?"/>
<p>å›é¡¾ä¸€ä¸‹å‰æ–‡ï¼Œæœ‰è¿™æ ·ä¸€æ®µï¼š</p>
<blockquote>
<p>åŠ¡å¿…æ³¨æ„ï¼Œä»…ç”¨äºæ˜¾ç¤ºæ—¶ï¼Œæˆ‘ä»¬å°šå¯ä»¥è¯´æœè‡ªå·±ä¸è´Ÿè´£ä»»åœ°å¿½ç•¥ "ä¸ç§»é™¤å›è°ƒ" å¸¦æ¥çš„è´Ÿé¢å½±å“ï¼Œè¯¸å¦‚æ— æ•ˆåˆ·æ–°ã€å†…å­˜æ³„éœ²ã€‚</p>
<p>è€Œåœ¨ç¼–è¾‘æ—¶ï¼ˆå¦‚EditTextä¸­ä½¿ç”¨ï¼Œå¹¶åˆ é™¤å›¾ç‰‡ï¼‰ã€ä»¥åŠRecycleViewä¸­TextViewå¤ç”¨ï¼ˆæ¨å¹¿åˆ°å¯æ›¿æ¢å‘ˆç°å†…å®¹çš„æƒ…å†µï¼‰
åˆ™ä¸å¾—ä¸ç§»é™¤å›è°ƒã€‚å¦åˆ™è½»åˆ™é€ æˆæ€§èƒ½æŸè€—å’Œå†…å­˜æ³„éœ²ï¼Œé‡åˆ™ç«‹ç° UI bugã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å·²ç»è§£å†³äº†ä¸€éƒ¨åˆ†é—®é¢˜ï¼š</p>
<ul>
<li>ç®€åŒ–æ³¨å†Œå›è°ƒï¼Œè®©Spannableå¯ä»¥è¢«å¤šä¸ªViewæœ‰æ•ˆå¤ç”¨ï¼Œå±•ç°å‡ºåŠ¨ç”»ã€‚å¹¶ä¸”åœ¨å·¥ç¨‹æ€§é—®é¢˜ä¸Šåšçš„ä¸é”™ã€‚</li>
<li>ç§»é™¤Spanæ—¶ï¼Œå¯¹å›è°ƒè¿›è¡Œè§£æ³¨å†Œã€‚å¯å›çœ‹ <code>AnimImageSpanWatcher</code> ä»£ç </li>
<li>ä½¿ç”¨è€…è®¤ä¸ºè‡ªèº«ä¸å†éœ€è¦è¢«å›è°ƒæ›´æ–°æ—¶ï¼Œè§£é™¤å›è°ƒã€‚å¯å›çœ‹ <code>OnRefreshListener</code> ä»£ç ï¼Œæ³¨æ„ï¼Œè¯¥æƒ…å†µå®Œå…¨äº¤ç»™ä¸šåŠ¡ç®¡æ§ã€‚</li>
<li>å¼±å¼•ç”¨ï¼Œä¸å¦¨ç¢ä½¿ç”¨è€…åŠå®¿ä¸»Activityè¢«å›æ”¶</li>
<li>ç­‰</li>
</ul>
<p>ä½†æœ‰ä¸€ä¸ªé‡è¦çš„é—®é¢˜ï¼šRecycleViewä¸­TextViewå¤ç”¨ï¼ˆæ¨å¹¿åˆ°å¯æ›¿æ¢å‘ˆç°å†…å®¹çš„æƒ…å†µï¼‰æ²¡æœ‰è€ƒè™‘ã€‚</p>
<p><em>ä½œè€…æŒ‰ï¼šæ³¨æ„ï¼ŒEditTextåœ¨ç¼–è¾‘æ—¶çš„ç‰¹æ€§ã€é€‰ä¸­ç‰¹æ€§ã€Spanæœºåˆ¶æœ¬èº«çš„ç‰¹æ€§é—®é¢˜ï¼Œæ²¡æœ‰åœ¨æœ¬ç¯‡ä¸­å±•å¼€ã€‚è¿™ä¸ä»£è¡¨å®ƒä»¬ä¸å­˜åœ¨ï¼</em></p>
<h2 id="æŒç»­æ€è€ƒéå¸¸é‡è¦çš„ç»“è¯­"><a class="header" href="#æŒç»­æ€è€ƒéå¸¸é‡è¦çš„ç»“è¯­">æŒç»­æ€è€ƒ&amp;éå¸¸é‡è¦çš„ç»“è¯­</a></h2>
<p><em>ä½œè€…æŒ‰ï¼šæœ¬ç¯‡çš„ç¯‡å¹…å·²ç»å¾ˆé•¿äº†ï¼Œæ‰€ä»¥è¿˜è¯·æ²¡æœ‰çœ‹è¿‡ç˜¾çš„è¯»è€…ä»¬è§è°…ï¼Œè€ƒè™‘åˆ°å¤§å¤šæ•°è¯»è€…çš„é˜…è¯»æ„Ÿå—ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ­¤ç»“æŸäº†</em></p>
<p>ä½†å°šé—ç•™3ä¸ªé—®é¢˜éœ€è¦æŒç»­æ€è€ƒï¼š</p>
<ol>
<li>RecycleViewä¸­ï¼Œæ§ä»¶å¤ç”¨äº†ï¼Œé—®é¢˜è¯¥å¦‚ä½•è§£å†³ï¼Ÿ</li>
</ol>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–é—®é¢˜æ¨¡å‹ï¼Œç”¨ <code>RecycleViewä¸­TextViewå¤ç”¨</code> æ¥è¡¨ç°å¤ªé‡äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>
<blockquote>
<p>ä¸€ä¸ªTextViewå±•ç° Spannable-Aï¼Œéšåå±•ç° Spannable-Bï¼Œ</p>
</blockquote>
<ol start="2">
<li>ä½¿ç”¨EditTextç¼–è¾‘æ—¶ï¼Œæ˜¯å¦ä¼šæœ‰æ–°çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šåˆ é™¤æ—¶å…ˆé€‰ä¸­çš„éœ€æ±‚ï¼Œåˆ é™¤å®Œä¹‹åï¼Œåˆåº”å½“å¦‚ä½•è§£å†³</li>
<li>ä»¥ä¸Šåšæ³•å·²ç»æ˜¯æœ€ä¼˜äº†å—ï¼Ÿè¿˜èƒ½ä¸èƒ½ç»§ç»­ä¼˜åŒ–</li>
</ol>
<p><em>å› ä¸ºæˆ‘è®¤ä¸ºä»¥ä¸Šä»£ç å°šå­˜åœ¨ä¼˜åŒ–ç©ºé—´ï¼Œå¹¶ä¸”æ¨æµ‹æ‚¨çš„é¡¹ç›®ä¸­å·²ç»ä½¿ç”¨äº†Spanæœºåˆ¶çš„æ‰©å±•ä»¥å®ç°æŸäº›éœ€æ±‚ï¼›</em></p>
<p><em>è€Œæˆ‘å°šä¸æ‰“ç®—èŠ±è´¹å¤§é‡çš„æ—¶é—´ç¼–å†™ç”¨äºå…¼å®¹ç”¨é€”çš„åŠŸèƒ½ç±»ã€‚æ‰€ä»¥æˆ‘å¹¶æœªå°†è¿™éƒ¨åˆ†ä»£ç ä¼ å…¥ä»“åº“ï¼Œé¿å…æ‚¨ç›´æ¥å½“åšåº“é¡¹ç›®ä½¿ç”¨ï¼Œå¯¼è‡´åŸåŠŸèƒ½æ¨¡å—ä¸å¯ç”¨ã€‚</em></p>
<p><em>å¦‚æœæ‚¨å¾ˆè¿«åˆ‡çš„éœ€è¦å°†å…¶ç§»æ¤åˆ°é¡¹ç›®ä¸­ï¼Œæ–‡ä¸­çš„ä»£ç å·²ç»æ¶µç›–æ‰€æœ‰é‡ç‚¹ï¼Œä½†è¯·åŠ¡å¿…è‡ªè¡Œæµ‹è¯•ç›¸å…³åŠŸèƒ½æ¨¡å—ï¼Œåšå¥½å…¼å®¹å·¥ä½œã€‚</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../Android/Drawable/post_47.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../Android/Mechanism/Message/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../Android/Drawable/post_47.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../Android/Mechanism/Message/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
