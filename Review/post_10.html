<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>造完了这个轮子--Mocker，却让我感到很羞愧|项目复盘 - leobert&#x27;s blog</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">目录</li><li class="chapter-item expanded "><a href="../Android/index.html"><strong aria-hidden="true">1.</strong> Android</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/View/index.html"><strong aria-hidden="true">1.1.</strong> View</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/View/post_1.html"><strong aria-hidden="true">1.1.1.</strong> 好玩系列：优雅的处理ButterKnife和KAE被废弃</a></li><li class="chapter-item expanded "><a href="../Android/View/post_6.html"><strong aria-hidden="true">1.1.2.</strong> 三思系列：View体系认知(一)，内容是如何正确被展现出来的--视觉呈现概览</a></li><li class="chapter-item expanded "><a href="../Android/View/post_7.html"><strong aria-hidden="true">1.1.3.</strong> 三思系列：为什么自定义View</a></li><li class="chapter-item expanded "><a href="../Android/Idea/post_9.html"><strong aria-hidden="true">1.1.4.</strong> 三思系列："声明式UI"和"命令式UI"，你的理解可能是错的</a></li></ol></li><li class="chapter-item expanded "><a href="../Android/Drawable/index.html"><strong aria-hidden="true">1.2.</strong> Drawable</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/Drawable/post_2.html"><strong aria-hidden="true">1.2.1.</strong> 三思系列：重新认识Drawable</a></li><li class="chapter-item expanded "><a href="../Android/Drawable/post_4.html"><strong aria-hidden="true">1.2.2.</strong> 好玩系列：拥有它，XML文件少一半--更方便的处理View背景</a></li><li class="chapter-item expanded "><a href="../Android/Drawable/post_47.html"><strong aria-hidden="true">1.2.3.</strong> 迟来的续集--Drawable+Animator，将优雅进行到底</a></li><li class="chapter-item expanded "><a href="../Android/Drawable/post_49.html"><strong aria-hidden="true">1.2.4.</strong> 好玩系列：让ImageSpan动起来</a></li></ol></li><li class="chapter-item expanded "><a href="../Android/Mechanism/Message/index.html"><strong aria-hidden="true">1.3.</strong> 消息机制</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/Mechanism/Message/post_8.html"><strong aria-hidden="true">1.3.1.</strong> 三思系列：Android的消息机制，一文吃透</a></li></ol></li><li class="chapter-item expanded "><a href="../Android/Idea/post_14/index.html"><strong aria-hidden="true">1.4.</strong> 兼容</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/Idea/post_14.html"><strong aria-hidden="true">1.4.1.</strong> 好玩系列：让项目中的相册支持Heif格式图片</a></li></ol></li><li class="chapter-item expanded "><a href="../Android/Glide/index.html"><strong aria-hidden="true">1.5.</strong> Glide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/Glide/post_15.html"><strong aria-hidden="true">1.5.1.</strong> 三思系列：Glide 4.X全方位认知 -- 模块职责概览</a></li><li class="chapter-item expanded "><a href="../Android/Glide/post_16.html"><strong aria-hidden="true">1.5.2.</strong> 三思系列：Glide 4.X加载过程一文掌握 | Glide（二）</a></li></ol></li><li class="chapter-item expanded "><a href="../Android/KSP/index.html"><strong aria-hidden="true">1.6.</strong> KSP</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/KSP/post_24.html"><strong aria-hidden="true">1.6.1.</strong> 好玩系列 | 拥抱Kotlin Symbol Processing(KSP),项目实战</a></li></ol></li><li class="chapter-item expanded "><a href="../Android/Base/index.html"><strong aria-hidden="true">1.7.</strong> 基础</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/Base/post_35.html"><strong aria-hidden="true">1.7.1.</strong> 孔乙己：你可知道页面和弹窗“通信“的方式有四种？</a></li></ol></li><li class="chapter-item expanded "><a href="../Android/SysApp/index.html"><strong aria-hidden="true">1.8.</strong> 系统APP</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/SysApp/post_52.html"><strong aria-hidden="true">1.8.1.</strong> 使用日历丰富产品的用户体验</a></li></ol></li><li class="chapter-item expanded "><a href="../Android/DI/index.html"><strong aria-hidden="true">1.9.</strong> Part4-依赖注入部分</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Android/DI/post_53.html"><strong aria-hidden="true">1.9.1.</strong> Hilt进阶--一文吃透Hilt自定义与跨壁垒</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../Compose/index.html"><strong aria-hidden="true">2.</strong> Jetpack Compose</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Compose/post_21.html"><strong aria-hidden="true">2.1.</strong> Jetpack Compose | 一文理解神奇的Modifier</a></li><li class="chapter-item expanded "><a href="../Compose/post_26.html"><strong aria-hidden="true">2.2.</strong> Jetpack Compose | 控件篇（一） -- Text、TextField、Button</a></li><li class="chapter-item expanded "><a href="../Compose/post_27.html"><strong aria-hidden="true">2.3.</strong> Jetpack Compose | 控件篇（二） -- Icon，Image</a></li><li class="chapter-item expanded "><a href="../Compose/post_28.html"><strong aria-hidden="true">2.4.</strong> Jetpack Compose | 控件篇（三） -- Switch、CheckBox、RadioButton</a></li><li class="chapter-item expanded "><a href="../Compose/post_29.html"><strong aria-hidden="true">2.5.</strong> Jetpack Compose | 控件篇（四）-- Box、Row、Column</a></li><li class="chapter-item expanded "><a href="../Compose/post_30.html"><strong aria-hidden="true">2.6.</strong> Jetpack Compose | 控件篇（五）-- Spacer、LazyRow、LazyColumn & 让Column可滑动</a></li></ol></li><li class="chapter-item expanded "><a href="../MultiThreading/index.html"><strong aria-hidden="true">3.</strong> Java多线程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../MultiThreading/post_33.html"><strong aria-hidden="true">3.1.</strong> 总纲</a></li><li class="chapter-item expanded "><a href="../MultiThreading/post_37.html"><strong aria-hidden="true">3.2.</strong> Java基础--图解JVM内存模型和JVM线程模型</a></li><li class="chapter-item expanded "><a href="../MultiThreading/post_38.html"><strong aria-hidden="true">3.3.</strong> Java多线程系列--掌控面试，一文吃透Synchronized锁</a></li><li class="chapter-item expanded "><a href="../MultiThreading/post_39.html"><strong aria-hidden="true">3.4.</strong> Java多线程基础--线程生命周期与线程协作详解</a></li><li class="chapter-item expanded "><a href="../MultiThreading/post_42.html"><strong aria-hidden="true">3.5.</strong> Java多线程基础--线程的创建与线程池管理</a></li><li class="chapter-item expanded "><a href="../MultiThreading/post_46.html"><strong aria-hidden="true">3.6.</strong> Java多线程系列--掌握Future，轻松获取异步任务结果</a></li><li class="chapter-item expanded "><a href="../MultiThreading/post_50.html"><strong aria-hidden="true">3.7.</strong> Java多线程系列--Fork&Join框架，分治的艺术</a></li><li class="chapter-item expanded "><a href="../MultiThreading/post_54.html"><strong aria-hidden="true">3.8.</strong> Java多线程系列--掌握CompletableFuture，驾驭异步编程</a></li></ol></li><li class="chapter-item expanded "><a href="../IO/index.html"><strong aria-hidden="true">4.</strong> Java IO系列</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../IO/post_55.html"><strong aria-hidden="true">4.1.</strong> Java IO 系列总纲</a></li><li class="chapter-item expanded "><a href="../IO/post_56.html"><strong aria-hidden="true">4.2.</strong> Java IO系列 | 经典 IO</a></li><li class="chapter-item expanded "><a href="../IO/post_57.html"><strong aria-hidden="true">4.3.</strong> Java IO 系列 | NIO-1.0一文速览</a></li><li class="chapter-item expanded "><a href="../IO/post_58.html"><strong aria-hidden="true">4.4.</strong> Java IO系列 | NIO-1.0拾遗、NIO-2.0 & 零拷贝必吹的牛皮</a></li><li class="chapter-item expanded "><a href="../IO/post_59.html"><strong aria-hidden="true">4.5.</strong> IO系列 | 一文掌握OKHTTP中的OKIO为什么这么OK</a></li></ol></li><li class="chapter-item expanded "><a href="../Gradle/index.html"><strong aria-hidden="true">5.</strong> Gradle</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Gradle/Modularization/post_18.html"><strong aria-hidden="true">5.1.</strong> 组件化：三思系列：组件化场景下module依赖优雅实践方案</a></li><li class="chapter-item expanded "><a href="../Gradle/Publish/post_17.html"><strong aria-hidden="true">5.2.</strong> MavenCentral发布：迁移到MavenCentral--再不行动起来，你的托管的library就没了</a></li><li class="chapter-item expanded "><a href="../Gradle/post_22.html"><strong aria-hidden="true">5.3.</strong> Gradle | 依赖管理最佳实践</a></li></ol></li><li class="chapter-item expanded "><a href="../Groovy/index.html"><strong aria-hidden="true">6.</strong> Groovy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Groovy/why_write_groovy.html"><strong aria-hidden="true">6.1.</strong> 为什么撰写这个系列</a></li><li class="chapter-item expanded "><a href="../Groovy/post_23.html"><strong aria-hidden="true">6.2.</strong> Groovy：MOP一文打尽</a></li></ol></li><li class="chapter-item expanded "><a href="../Review/index.html"><strong aria-hidden="true">7.</strong> Review</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Review/post_10.html" class="active"><strong aria-hidden="true">7.1.</strong> 造完了这个轮子--Mocker，却让我感到很羞愧|项目复盘</a></li><li class="chapter-item expanded "><a href="../Review/post_40.html"><strong aria-hidden="true">7.2.</strong> 三思系列：前人用GreenDao留下的坑，全线被扣了绩效</a></li><li class="chapter-item expanded "><a href="../Review/post_44.html"><strong aria-hidden="true">7.3.</strong> 谈一谈在两个商业项目中使用MVI架构后的感悟</a></li><li class="chapter-item expanded "><a href="../Review/post_45.html"><strong aria-hidden="true">7.4.</strong> Review | 这三个坑你遇到了吗？</a></li></ol></li><li class="chapter-item expanded "><a href="../repo/index.html"><strong aria-hidden="true">8.</strong> 个人项目</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../repo/DaVinCi.html"><strong aria-hidden="true">8.1.</strong> DaVinCi,取代XML编写Shape或ColorStateList的方案</a></li><li class="chapter-item expanded "><a href="../Android/Idea/post_32.html"><strong aria-hidden="true">8.2.</strong> 好玩系列：白嫖一个优雅的类图生成工具</a></li><li class="chapter-item expanded "><a href="../Speculative/post_43.html"><strong aria-hidden="true">8.3.</strong> 初体验：动手搭建"小清新式"局域网文档系统</a></li><li class="chapter-item expanded "><a href="../repo/post_48.html"><strong aria-hidden="true">8.4.</strong> 研究良久，终于发现了他代码写的快且bug少的原因</a></li><li class="chapter-item expanded "><a href="../Speculative/post_61.html"><strong aria-hidden="true">8.5.</strong> 好玩系列 | 如果后端让你用SSE接收多次返回，那我们改造Retrofit吧</a></li></ol></li><li class="chapter-item expanded "><a href="../Review/DataStructure/index.html"><strong aria-hidden="true">9.</strong> 数据结构</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Review/DataStructure/post_11.html"><strong aria-hidden="true">9.1.</strong> 温故：线性表</a></li><li class="chapter-item expanded "><a href="../Review/DataStructure/post_12.html"><strong aria-hidden="true">9.2.</strong> 温故：栈</a></li><li class="chapter-item expanded "><a href="../Review/DataStructure/post_13.html"><strong aria-hidden="true">9.3.</strong> 温故：队列</a></li></ol></li><li class="chapter-item expanded "><a href="../Review/README2.html"><strong aria-hidden="true">10.</strong> 年终总结&计划</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Review/post_36.html"><strong aria-hidden="true">10.1.</strong> 2021年终总结</a></li><li class="chapter-item expanded "><a href="../Review/post_51.html"><strong aria-hidden="true">10.2.</strong> 关于画一个句号--基于2022年终总结的反思与分享</a></li><li class="chapter-item expanded "><a href="../Review/post_60.html"><strong aria-hidden="true">10.3.</strong> 突如其来的秋季反思</a></li><li class="chapter-item expanded "><a href="../Review/post_63.html"><strong aria-hidden="true">10.4.</strong> 2023年总结 寻找到源于内心深处的无穷力量</a></li><li class="chapter-item expanded "><a href="../Review/post_64.html"><strong aria-hidden="true">10.5.</strong> 2024年中思考，推倒樊笼重新出发</a></li></ol></li><li class="chapter-item expanded "><a href="../Note/index.html"><strong aria-hidden="true">11.</strong> 读书笔记</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Note/post_41.html"><strong aria-hidden="true">11.1.</strong> 读书笔记：《简约至上--交互式设计四策略》</a></li><li class="chapter-item expanded "><a href="../Talk/talk_4_2024-08.html"><strong aria-hidden="true">11.2.</strong> 读书笔记 - 《团队管理》精华摘要</a></li></ol></li><li class="chapter-item expanded "><a href="../Talk/index.html"><strong aria-hidden="true">12.</strong> 杂谈</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Talk/talk_1.html"><strong aria-hidden="true">12.1.</strong> 杂谈1-2022-11</a></li><li class="chapter-item expanded "><a href="../Talk/talk_2_2023-03.html"><strong aria-hidden="true">12.2.</strong> 杂篇（二）-- 认识并战胜焦虑</a></li><li class="chapter-item expanded "><a href="../Talk/talk_3_2024-08.html"><strong aria-hidden="true">12.3.</strong> 杂谈（三）-- 向钱看，你需要想明白企业在为什么而付钱</a></li></ol></li><li class="chapter-item expanded "><a href="../Thought/index.html"><strong aria-hidden="true">13.</strong> 半成熟的思考</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Thought/post_62.html"><strong aria-hidden="true">13.1.</strong> 好玩系列 | 当SPI 和 设计模式、依赖注入发生碰撞，可以擦出怎样的火花</a></li></ol></li><li class="chapter-item expanded "><a href="../info/index.html"><strong aria-hidden="true">14.</strong> 系列说明</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../info/about_view_series.html"><strong aria-hidden="true">14.1.</strong> 关于View系列</a></li><li class="chapter-item expanded "><a href="../info/about_sansi_series.html"><strong aria-hidden="true">14.2.</strong> 关于三思系列</a></li><li class="chapter-item expanded "><a href="../info/about_haowan_series.html"><strong aria-hidden="true">14.3.</strong> 关于好玩系列</a></li><li class="chapter-item expanded "><a href="../info/about_wengu_series.html"><strong aria-hidden="true">14.4.</strong> 关于温故系列</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">leobert&#x27;s blog</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="造完了这个轮子--mocker却让我感到很羞愧项目复盘"><a class="header" href="#造完了这个轮子--mocker却让我感到很羞愧项目复盘">造完了这个轮子--Mocker，却让我感到很羞愧|项目复盘</a></h1>
<blockquote>
<p>有必要声明，这篇文章不是标题党，内容也不是凡尔赛。</p>
</blockquote>
<p>作为一个Android开发者，我这5年造了 <code>很多</code> 轮子, 粗略数一下：</p>
<ul>
<li>基于FastJson修改了一些漏洞，并兼容了ThinkPHP框架 <code>简化JSON结构的机制</code> -- 单元素数组直接变对象</li>
<li>MagicBox -- <code>注解</code> + <code>运行时反射</code> 简化SaveInstanceState样板代码</li>
<li>JSBridge -- 基于消息队列机制建立Android和WebView桥接</li>
<li>RetrofitExt -- <code>注解</code> + <code>APT</code> + <code>动态代理</code> 实现Retrofit请求生命周期管理</li>
<li>DDComponentForAndroid(后改为JIMU)组件化套件
<ul>
<li>Gradle Plugin 优化</li>
<li>路由中间件</li>
<li>消息中间件</li>
<li>Maat -- 代码隔离场景下的模块加载框架</li>
</ul>
</li>
<li>Pandora套件
<ul>
<li>Pandora -- 适用于复杂列表页面的数据结构</li>
<li>Pandorarv -- RecyclerView 多样式表</li>
<li>Pandora Plugin -- Intellij 插件，快速生成 <code>数据代理</code> + <code>ViewHolder</code> + <code>基础布局</code></li>
</ul>
</li>
<li>Reporter -- 注解生成文档</li>
<li>DaVinCi -- 干掉shape xml</li>
<li><strong><a href="https://github.com/leobert-lan/Mocker">Mocker</a> -- 注解约束的Mock框架</strong></li>
<li>UiBinding -- 取代ButterKnife&amp;更方便的使用ViewBinding、DataBinding</li>
</ul>
<p>至于自定义视图，RecyclerView相关套件等等，也是一大堆。</p>
<p>其中：</p>
<ul>
<li>有一些是项目不得不拥有</li>
<li>有一些，是项目中遇到了效率问题，为了解决开发效率问题而开发的，例如Pandora套件</li>
<li>还有一些，纯粹是出于 <code>兴趣</code> ，<code>好玩</code> 例如 Reporter，利用注解生成文档。</li>
</ul>
<p><strong>但是，有这么一个轮子，写完之后，让我自己感觉很羞愧，并且 <code>为团队</code> 感到羞愧。标题中提到的 <code>Mocker</code> -- 注解约束的Mock框架</strong></p>
<hr />
<h2 id="为什么我造了那么多轮子却要复盘这个"><a class="header" href="#为什么我造了那么多轮子却要复盘这个">为什么我造了那么多轮子却要复盘这个？</a></h2>
<p><a href="https://github.com/leobert-lan/Mocker">Mocker</a></p>
<ul>
<li>这个轮子，和其他的有 <code>本质区别</code>，可以说，别的轮子，都是服务于 <code>业务实现</code>、<code>效率</code>，而Mocker，服务于 <code>测试</code>。</li>
<li>这是复盘系列的第一篇，我希望利用形式来践行：<code>先思败</code>，<code>避开失败点，自然走向成功</code></li>
</ul>
<p>我属于 <code>极限编程</code> 的极力反对者，毫无疑问，我认为 <code>单元测试</code> 用例长期有效即具有<code>长效性</code> ，并值得 <code>持续维护</code>。而我们的项目团队，单元测试覆盖量近乎于1%。</p>
<p><code>创业团队</code>，<code>价值导向</code>，<code>快才是好，越快越好</code>，<code>快也不是出错的理由</code> 这是目前的团队背景标签。
处于这样的背景下，还身在前端团队，大力推行 <code>TDD</code> 阻力很大，但这不是不作为的理由。</p>
<h2 id="把握测试的粒度"><a class="header" href="#把握测试的粒度">把握测试的粒度</a></h2>
<p>前面提到一句："大力推行 TDD 阻力很大"，Why？</p>
<p>对TDD有一定了解的读者不难理解：设计、编写单测用例的时间 ＞ 开发对应模块功能的时间</p>
<p><code>打工人</code> 和 <code>资本家</code>难以就此达成理念一致，能够被接受的，只是一个权衡下的结果，这要求我们 <code>把握测试的粒度</code>。</p>
<p>我们知道：<code>单元测试</code> 的本质是 对软件中的最小可测试单元进行检查和验证。</p>
<p>而在Android客户端代码中，必然有一道分水岭，隔开了 <code>业务</code> 和 <code>框架</code>。</p>
<p><strong>对于框架</strong>，引入的三方框架，进行一定的<code>冒烟</code>即可，而对于自研的框架，最好严格的遵循TDD。但是注意，这部分工作和 <code>业务层的测试</code> 是无关的。</p>
<p><em>不见得会天天折腾框架，但一定天天要处理业务。</em></p>
<p><strong>对于业务</strong>，基本可以分为3块：</p>
<ul>
<li>视图</li>
<li>业务逻辑</li>
<li>数据</li>
</ul>
<p>一般而言：</p>
<ul>
<li>视图层的，集成测试即可，哪怕自己写完了运行下过过眼。</li>
<li>数据层的，对Web-Service进行的测试不需要前端，基于本地DB建立的业务，作为业务逻辑测试。</li>
<li>业务逻辑，把握重点。</li>
</ul>
<p>另外，项目中会存在各种 <code>数据类代理</code>，<code>数据中介者</code>，<code>Wrapper</code>，这些类基于基础数据类进行了读写封装，或者功能装饰，也值得进行逻辑测试</p>
<h2 id="测试时的障碍--为什么造这个轮子"><a class="header" href="#测试时的障碍--为什么造这个轮子">测试时的障碍--为什么造这个轮子</a></h2>
<p>在前面的复盘中，我们已经清楚了对哪些内容进行单测，即粒度问题。而我们项目的分层架构，基本是：</p>
<ul>
<li>MVC</li>
<li>MVP</li>
<li>MVVM</li>
<li>一些变种 如MVI</li>
</ul>
<p>那么，测试的主要对象就是：C，P，VM，I这些层。而对于这些内容测试时，需要：注入<code>Model</code>和<code>View</code>，这一点无法避免。</p>
<p>如果说，设计时考虑了 <code>可测性</code>，那么至少在这些业务层，考虑了<code>依赖注入</code>，<code>依赖抽象</code>。那么在此基础上，我们不用担心 <code>View的复杂性</code>，
因为View层东西都不参与测试，而且不应当干预到测试。</p>
<p>但是Model层不一样。这些业务层的业务就是：</p>
<blockquote>
<p>响应视图层交互 -&gt; 执行附加业务 -&gt;操作Model-&gt; .... -&gt; 响应Model的变化 -&gt; 执行附加业务 -&gt; 反馈到视图层显示</p>
</blockquote>
<p>而利用真实的Model来进行测试，太重，并且可能对测试产生干扰项。所以 <code>不可避免</code> 的，我们需要 <code>设计Model的状态</code> 并进行 <code>Mock</code>，参与业务层测试。</p>
<p>如果能够以 <code>最小的时间</code> 代价，准确地获得期望的 Model实例，那是极好的。</p>
<h2 id="轮子有了却没有车"><a class="header" href="#轮子有了却没有车">轮子有了，却没有车</a></h2>
<p>非常遗憾，我花费了半个月的个人时间实现了轮子，转过头来，车并没有来。这一点，我 <code>为团队</code> 感到一丝羞愧。</p>
<p>分明大家都知道，一旦开始考虑TDD：</p>
<ul>
<li>设计会变得更加合理、健壮</li>
<li>编码会变得目的明确</li>
<li>bug会变少、交付质量提升</li>
<li>用例作为资产，可以检验迭代需求的合理性</li>
</ul>
<p>除此之外，我更为自己感到羞愧，因为 <code>自己没有极力推行</code> 并 <code>证明这样做给团队带来的改变</code>。</p>
<h2 id="知耻而后勇"><a class="header" href="#知耻而后勇">知耻而后勇</a></h2>
<p>自我鞭策，在项目中真正落地。自我检讨到此为止。</p>
<h2 id="关于项目本身"><a class="header" href="#关于项目本身">关于项目本身</a></h2>
<p>存在一个和Mock <code>相对</code> 的一个概念： <code>Bean Validation</code>，Bean Validation 是契约式编程的一种体现，<code>基于契约</code> 对数据类进行数据、状态校验。</p>
<p>而Mock 是基于契约生成假数据，构建数据类，但往往这个契约的 <code>约束内容较少</code>。</p>
<p>因为使用场景是单测，所以性能并不是第一要素，我很大胆的尝试了 <code>Kotlin的运行时反射</code>，并第一次在项目中直接使用Unsafe，收益良多。</p>
<h3 id="设计概要"><a class="header" href="#设计概要">设计概要</a></h3>
<p>mock的思路还是比较清晰的，大体上需要处理三类事情：</p>
<ul>
<li>数组和集合
<ul>
<li>结构性</li>
<li>泛型</li>
<li>元素赋值</li>
</ul>
</li>
<li>数据类
<ul>
<li>泛型</li>
<li>依赖注入</li>
<li>基本数据类型赋值</li>
</ul>
</li>
<li>深度问题，举个例子：单链表导致mock死循环</li>
</ul>
<p>在设计契约约束时，采用了 <code>注解表达</code>，例如：IntRange 和 IntDef，可以分别表示 <code>取值范围</code> 和 <code>取值枚举</code></p>
<p>只需要为 <code>基础数据类型</code> 和 <code>String</code> 设计一个 <code>池</code>，可以表达 <code>范围</code> 和 <code>枚举</code>，并且可以获知 <code>size</code>，即可利用Random，得到随机值。</p>
<p>水到渠成地，在反射数据类时，获取 <code>field</code> 信息以及其注解信息， 在为 <code>基本数据类型及其箱体类型</code> &amp; <code>String</code> field 赋值时，
先维护类型取值池，再Random取值即可达成：<code>取值受限</code> 和 <code>随机性</code>。</p>
<p>而结构型和数据类的构建，对Gson项目比较熟悉的读者就 <code>熟稔于心</code> 了，项目采用了类似实现。</p>
<p>但是在 <code>深度问题</code> 上，我 <code>并没有</code> 想到比较好的方案，目前只是尽力规避了死循环，并在绝大多数场景下，复用了先前创建的对象。</p>
<h2 id="总结"><a class="header" href="#总结">总结</a></h2>
<p>在活动的驱使下，这篇复盘思考了 <code>Mocker项目</code> 和 <code>公司商业应用在单测方面的不足</code>。既然复盘，那就需要 <code>规划改善不足</code>。</p>
<p>对于Mocker：</p>
<ul>
<li>参考 <code>Jsr303</code> 和 <code>Jsr380</code>，提供更广兼容、并且打通顺势造一个Android中轮子，一套注解服务于Mock 和 Bean Validation。</li>
<li>尝试解决深度问题。</li>
</ul>
<p>对于公司项目，推进好的idea落地。</p>
<p>最后引用一句名人名言：</p>
<blockquote>
<p>在需要面前，一切理想主义都是虚伪的 -- 尼采</p>
</blockquote>
<p>本文正在参与「掘金 2021 春招闯关活动」, 点击查看 <a href="https://juejin.cn/post/6939329638506168334">活动详情</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Review/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../Review/post_40.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Review/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../Review/post_40.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
